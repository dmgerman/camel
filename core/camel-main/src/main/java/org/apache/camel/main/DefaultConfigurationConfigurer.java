begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  * Licensed to the Apache Software Foundation (ASF) under one or more  * contributor license agreements.  See the NOTICE file distributed with  * this work for additional information regarding copyright ownership.  * The ASF licenses this file to You under the Apache License, Version 2.0  * (the "License"); you may not use this file except in compliance with  * the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
DECL|package|org.apache.camel.main
package|package
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|main
package|;
end_package

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashSet
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Set
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|function
operator|.
name|Consumer
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|function
operator|.
name|Predicate
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|CamelContext
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|Exchange
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|ExtendedCamelContext
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|TypeConverters
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|cloud
operator|.
name|ServiceRegistry
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|cluster
operator|.
name|CamelClusterService
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|health
operator|.
name|HealthCheckRegistry
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|health
operator|.
name|HealthCheckRepository
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|health
operator|.
name|HealthCheckService
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|model
operator|.
name|Model
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|processor
operator|.
name|interceptor
operator|.
name|BacklogTracer
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|AsyncProcessorAwaitManager
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|ClassResolver
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|Debugger
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|EndpointStrategy
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|EventFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|EventNotifier
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|ExecutorServiceManager
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|FactoryFinderResolver
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|InflightRepository
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|InterceptStrategy
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|LifecycleStrategy
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|LogListener
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|ManagementObjectNameStrategy
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|ManagementStrategy
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|MessageHistoryFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|ModelJAXBContextFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|NodeIdFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|ProcessorFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|PropertiesComponent
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|ReactiveExecutor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|Registry
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|RouteController
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|RoutePolicyFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|RuntimeEndpointRegistry
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|ShutdownStrategy
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|StreamCachingStrategy
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|ThreadPoolFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|ThreadPoolProfile
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|UnitOfWorkFactory
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|spi
operator|.
name|UuidGenerator
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|support
operator|.
name|jsse
operator|.
name|GlobalSSLContextParametersSupplier
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|util
operator|.
name|ObjectHelper
import|;
end_import

begin_import
import|import
name|org
operator|.
name|slf4j
operator|.
name|Logger
import|;
end_import

begin_import
import|import
name|org
operator|.
name|slf4j
operator|.
name|LoggerFactory
import|;
end_import

begin_comment
comment|/**  * To configure the {@link DefaultConfigurationProperties} on {@link org.apache.camel.CamelContext}  * used by Camel Main, Camel Spring Boot and other runtimes.  */
end_comment

begin_class
DECL|class|DefaultConfigurationConfigurer
specifier|public
specifier|final
class|class
name|DefaultConfigurationConfigurer
block|{
DECL|field|LOG
specifier|public
specifier|static
specifier|final
name|Logger
name|LOG
init|=
name|LoggerFactory
operator|.
name|getLogger
argument_list|(
name|DefaultConfigurationConfigurer
operator|.
name|class
argument_list|)
decl_stmt|;
DECL|method|DefaultConfigurationConfigurer ()
specifier|private
name|DefaultConfigurationConfigurer
parameter_list|()
block|{     }
comment|/**      * Configures the {@link CamelContext} with the configuration.      *      * @param camelContext the camel context      * @param config       the configuration      */
DECL|method|configure (CamelContext camelContext, DefaultConfigurationProperties config)
specifier|public
specifier|static
name|void
name|configure
parameter_list|(
name|CamelContext
name|camelContext
parameter_list|,
name|DefaultConfigurationProperties
name|config
parameter_list|)
throws|throws
name|Exception
block|{
name|camelContext
operator|.
name|adapt
argument_list|(
name|ExtendedCamelContext
operator|.
name|class
argument_list|)
operator|.
name|getBeanIntrospection
argument_list|()
operator|.
name|setExtendedStatistics
argument_list|(
name|config
operator|.
name|isBeanIntrospectionExtendedStatistics
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|.
name|getBeanIntrospectionLoggingLevel
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|camelContext
operator|.
name|adapt
argument_list|(
name|ExtendedCamelContext
operator|.
name|class
argument_list|)
operator|.
name|getBeanIntrospection
argument_list|()
operator|.
name|setLoggingLevel
argument_list|(
name|config
operator|.
name|getBeanIntrospectionLoggingLevel
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|config
operator|.
name|isJmxEnabled
argument_list|()
condition|)
block|{
name|camelContext
operator|.
name|disableJMX
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|config
operator|.
name|getName
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|camelContext
operator|.
name|adapt
argument_list|(
name|ExtendedCamelContext
operator|.
name|class
argument_list|)
operator|.
name|setName
argument_list|(
name|config
operator|.
name|getName
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|config
operator|.
name|getShutdownTimeout
argument_list|()
operator|>
literal|0
condition|)
block|{
name|camelContext
operator|.
name|getShutdownStrategy
argument_list|()
operator|.
name|setTimeout
argument_list|(
name|config
operator|.
name|getShutdownTimeout
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|camelContext
operator|.
name|getShutdownStrategy
argument_list|()
operator|.
name|setSuppressLoggingOnTimeout
argument_list|(
name|config
operator|.
name|isShutdownSuppressLoggingOnTimeout
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|getShutdownStrategy
argument_list|()
operator|.
name|setShutdownNowOnTimeout
argument_list|(
name|config
operator|.
name|isShutdownNowOnTimeout
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|getShutdownStrategy
argument_list|()
operator|.
name|setShutdownRoutesInReverseOrder
argument_list|(
name|config
operator|.
name|isShutdownRoutesInReverseOrder
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|getShutdownStrategy
argument_list|()
operator|.
name|setLogInflightExchangesOnTimeout
argument_list|(
name|config
operator|.
name|isShutdownLogInflightExchangesOnTimeout
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|.
name|getLogDebugMaxChars
argument_list|()
operator|!=
literal|0
condition|)
block|{
name|camelContext
operator|.
name|getGlobalOptions
argument_list|()
operator|.
name|put
argument_list|(
name|Exchange
operator|.
name|LOG_DEBUG_BODY_MAX_CHARS
argument_list|,
literal|""
operator|+
name|config
operator|.
name|getLogDebugMaxChars
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|// stream caching
name|camelContext
operator|.
name|setStreamCaching
argument_list|(
name|config
operator|.
name|isStreamCachingEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|getStreamCachingStrategy
argument_list|()
operator|.
name|setAnySpoolRules
argument_list|(
name|config
operator|.
name|isStreamCachingAnySpoolRules
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|getStreamCachingStrategy
argument_list|()
operator|.
name|setBufferSize
argument_list|(
name|config
operator|.
name|getStreamCachingBufferSize
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|getStreamCachingStrategy
argument_list|()
operator|.
name|setRemoveSpoolDirectoryWhenStopping
argument_list|(
name|config
operator|.
name|isStreamCachingRemoveSpoolDirectoryWhenStopping
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|getStreamCachingStrategy
argument_list|()
operator|.
name|setSpoolCipher
argument_list|(
name|config
operator|.
name|getStreamCachingSpoolCipher
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|.
name|getStreamCachingSpoolDirectory
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|camelContext
operator|.
name|getStreamCachingStrategy
argument_list|()
operator|.
name|setSpoolDirectory
argument_list|(
name|config
operator|.
name|getStreamCachingSpoolDirectory
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|config
operator|.
name|getStreamCachingSpoolThreshold
argument_list|()
operator|!=
literal|0
condition|)
block|{
name|camelContext
operator|.
name|getStreamCachingStrategy
argument_list|()
operator|.
name|setSpoolThreshold
argument_list|(
name|config
operator|.
name|getStreamCachingSpoolThreshold
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|config
operator|.
name|getStreamCachingSpoolUsedHeapMemoryLimit
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|StreamCachingStrategy
operator|.
name|SpoolUsedHeapMemoryLimit
name|limit
decl_stmt|;
if|if
condition|(
literal|"Committed"
operator|.
name|equalsIgnoreCase
argument_list|(
name|config
operator|.
name|getStreamCachingSpoolUsedHeapMemoryLimit
argument_list|()
argument_list|)
condition|)
block|{
name|limit
operator|=
name|StreamCachingStrategy
operator|.
name|SpoolUsedHeapMemoryLimit
operator|.
name|Committed
expr_stmt|;
block|}
elseif|else
if|if
condition|(
literal|"Max"
operator|.
name|equalsIgnoreCase
argument_list|(
name|config
operator|.
name|getStreamCachingSpoolUsedHeapMemoryLimit
argument_list|()
argument_list|)
condition|)
block|{
name|limit
operator|=
name|StreamCachingStrategy
operator|.
name|SpoolUsedHeapMemoryLimit
operator|.
name|Max
expr_stmt|;
block|}
else|else
block|{
throw|throw
operator|new
name|IllegalArgumentException
argument_list|(
literal|"Invalid option "
operator|+
name|config
operator|.
name|getStreamCachingSpoolUsedHeapMemoryLimit
argument_list|()
operator|+
literal|" must either be Committed or Max"
argument_list|)
throw|;
block|}
name|camelContext
operator|.
name|getStreamCachingStrategy
argument_list|()
operator|.
name|setSpoolUsedHeapMemoryLimit
argument_list|(
name|limit
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|config
operator|.
name|getStreamCachingSpoolUsedHeapMemoryThreshold
argument_list|()
operator|!=
literal|0
condition|)
block|{
name|camelContext
operator|.
name|getStreamCachingStrategy
argument_list|()
operator|.
name|setSpoolUsedHeapMemoryThreshold
argument_list|(
name|config
operator|.
name|getStreamCachingSpoolUsedHeapMemoryThreshold
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|camelContext
operator|.
name|setMessageHistory
argument_list|(
name|config
operator|.
name|isMessageHistory
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|setLogMask
argument_list|(
name|config
operator|.
name|isLogMask
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|setLogExhaustedMessageBody
argument_list|(
name|config
operator|.
name|isLogExhaustedMessageBody
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|setAutoStartup
argument_list|(
name|config
operator|.
name|isAutoStartup
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|setAllowUseOriginalMessage
argument_list|(
name|config
operator|.
name|isAllowUseOriginalMessage
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|setUseBreadcrumb
argument_list|(
name|config
operator|.
name|isUseBreadcrumb
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|setUseDataType
argument_list|(
name|config
operator|.
name|isUseDataType
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|setUseMDCLogging
argument_list|(
name|config
operator|.
name|isUseMdcLogging
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|setMDCLoggingKeysPattern
argument_list|(
name|config
operator|.
name|getMdcLoggingKeysPattern
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|setLoadTypeConverters
argument_list|(
name|config
operator|.
name|isLoadTypeConverters
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|camelContext
operator|.
name|getManagementStrategy
argument_list|()
operator|.
name|getManagementAgent
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|camelContext
operator|.
name|getManagementStrategy
argument_list|()
operator|.
name|getManagementAgent
argument_list|()
operator|.
name|setEndpointRuntimeStatisticsEnabled
argument_list|(
name|config
operator|.
name|isEndpointRuntimeStatisticsEnabled
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|getManagementStrategy
argument_list|()
operator|.
name|getManagementAgent
argument_list|()
operator|.
name|setStatisticsLevel
argument_list|(
name|config
operator|.
name|getJmxManagementStatisticsLevel
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|getManagementStrategy
argument_list|()
operator|.
name|getManagementAgent
argument_list|()
operator|.
name|setManagementNamePattern
argument_list|(
name|config
operator|.
name|getJmxManagementNamePattern
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|getManagementStrategy
argument_list|()
operator|.
name|getManagementAgent
argument_list|()
operator|.
name|setCreateConnector
argument_list|(
name|config
operator|.
name|isJmxCreateConnector
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|// global endpoint configurations
name|camelContext
operator|.
name|getGlobalEndpointConfiguration
argument_list|()
operator|.
name|setBasicPropertyBinding
argument_list|(
name|config
operator|.
name|isEndpointBasicPropertyBinding
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|getGlobalEndpointConfiguration
argument_list|()
operator|.
name|setBridgeErrorHandler
argument_list|(
name|config
operator|.
name|isEndpointBridgeErrorHandler
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|getGlobalEndpointConfiguration
argument_list|()
operator|.
name|setLazyStartProducer
argument_list|(
name|config
operator|.
name|isEndpointLazyStartProducer
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|setBacklogTracing
argument_list|(
name|config
operator|.
name|isBacklogTracing
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|setTracing
argument_list|(
name|config
operator|.
name|isTracing
argument_list|()
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|setTracingPattern
argument_list|(
name|config
operator|.
name|getTracingPattern
argument_list|()
argument_list|)
expr_stmt|;
if|if
condition|(
name|config
operator|.
name|getThreadNamePattern
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|camelContext
operator|.
name|getExecutorServiceManager
argument_list|()
operator|.
name|setThreadNamePattern
argument_list|(
name|config
operator|.
name|getThreadNamePattern
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|config
operator|.
name|getRouteFilterIncludePattern
argument_list|()
operator|!=
literal|null
operator|||
name|config
operator|.
name|getRouteFilterExcludePattern
argument_list|()
operator|!=
literal|null
condition|)
block|{
name|camelContext
operator|.
name|getExtension
argument_list|(
name|Model
operator|.
name|class
argument_list|)
operator|.
name|setRouteFilterPattern
argument_list|(
name|config
operator|.
name|getRouteFilterIncludePattern
argument_list|()
argument_list|,
name|config
operator|.
name|getRouteFilterExcludePattern
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**      * Performs additional configuration to lookup beans of Camel types to configure      * additional configurations on the Camel context.      *<p/>      * Similar code in camel-core-xml module in class org.apache.camel.core.xml.AbstractCamelContextFactoryBean      * or in camel-spring-boot module in class org.apache.camel.spring.boot.CamelAutoConfiguration.      */
DECL|method|afterPropertiesSet (final CamelContext camelContext)
specifier|public
specifier|static
name|void
name|afterPropertiesSet
parameter_list|(
specifier|final
name|CamelContext
name|camelContext
parameter_list|)
throws|throws
name|Exception
block|{
specifier|final
name|Registry
name|registry
init|=
name|camelContext
operator|.
name|getRegistry
argument_list|()
decl_stmt|;
specifier|final
name|ManagementStrategy
name|managementStrategy
init|=
name|camelContext
operator|.
name|getManagementStrategy
argument_list|()
decl_stmt|;
specifier|final
name|ExtendedCamelContext
name|ecc
init|=
name|camelContext
operator|.
name|adapt
argument_list|(
name|ExtendedCamelContext
operator|.
name|class
argument_list|)
decl_stmt|;
name|PropertiesComponent
name|pc
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|PropertiesComponent
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|pc
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setPropertiesComponent
argument_list|(
name|pc
argument_list|)
expr_stmt|;
block|}
name|BacklogTracer
name|bt
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|BacklogTracer
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|bt
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setExtension
argument_list|(
name|BacklogTracer
operator|.
name|class
argument_list|,
name|bt
argument_list|)
expr_stmt|;
block|}
name|InflightRepository
name|ir
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|InflightRepository
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|ir
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setInflightRepository
argument_list|(
name|ir
argument_list|)
expr_stmt|;
block|}
name|AsyncProcessorAwaitManager
name|apam
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|AsyncProcessorAwaitManager
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|apam
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setAsyncProcessorAwaitManager
argument_list|(
name|apam
argument_list|)
expr_stmt|;
block|}
name|ManagementStrategy
name|ms
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|ManagementStrategy
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|ms
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setManagementStrategy
argument_list|(
name|ms
argument_list|)
expr_stmt|;
block|}
name|ManagementObjectNameStrategy
name|mons
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|ManagementObjectNameStrategy
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|mons
operator|!=
literal|null
condition|)
block|{
name|managementStrategy
operator|.
name|setManagementObjectNameStrategy
argument_list|(
name|mons
argument_list|)
expr_stmt|;
block|}
name|EventFactory
name|ef
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|EventFactory
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|ef
operator|!=
literal|null
condition|)
block|{
name|managementStrategy
operator|.
name|setEventFactory
argument_list|(
name|ef
argument_list|)
expr_stmt|;
block|}
name|UnitOfWorkFactory
name|uowf
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|UnitOfWorkFactory
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|uowf
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setUnitOfWorkFactory
argument_list|(
name|uowf
argument_list|)
expr_stmt|;
block|}
name|RuntimeEndpointRegistry
name|rer
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|RuntimeEndpointRegistry
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|rer
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setRuntimeEndpointRegistry
argument_list|(
name|rer
argument_list|)
expr_stmt|;
block|}
name|ModelJAXBContextFactory
name|mjcf
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|ModelJAXBContextFactory
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|mjcf
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setModelJAXBContextFactory
argument_list|(
name|mjcf
argument_list|)
expr_stmt|;
block|}
name|ClassResolver
name|cr
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|ClassResolver
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|cr
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setClassResolver
argument_list|(
name|cr
argument_list|)
expr_stmt|;
block|}
name|FactoryFinderResolver
name|ffr
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|FactoryFinderResolver
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|ffr
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setFactoryFinderResolver
argument_list|(
name|ffr
argument_list|)
expr_stmt|;
block|}
name|RouteController
name|rc
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|RouteController
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|rc
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setRouteController
argument_list|(
name|rc
argument_list|)
expr_stmt|;
block|}
name|UuidGenerator
name|ug
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|UuidGenerator
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|ug
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setUuidGenerator
argument_list|(
name|ug
argument_list|)
expr_stmt|;
block|}
name|ExecutorServiceManager
name|esm
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|ExecutorServiceManager
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|esm
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setExecutorServiceManager
argument_list|(
name|esm
argument_list|)
expr_stmt|;
block|}
name|ThreadPoolFactory
name|tpf
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|ThreadPoolFactory
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|tpf
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|getExecutorServiceManager
argument_list|()
operator|.
name|setThreadPoolFactory
argument_list|(
name|tpf
argument_list|)
expr_stmt|;
block|}
name|ProcessorFactory
name|pf
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|ProcessorFactory
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|pf
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setProcessorFactory
argument_list|(
name|pf
argument_list|)
expr_stmt|;
block|}
name|Debugger
name|debugger
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|Debugger
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|debugger
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setDebugger
argument_list|(
name|debugger
argument_list|)
expr_stmt|;
block|}
name|NodeIdFactory
name|nif
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|NodeIdFactory
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|nif
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setNodeIdFactory
argument_list|(
name|nif
argument_list|)
expr_stmt|;
block|}
name|MessageHistoryFactory
name|mhf
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|MessageHistoryFactory
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|mhf
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setMessageHistoryFactory
argument_list|(
name|mhf
argument_list|)
expr_stmt|;
block|}
name|ReactiveExecutor
name|re
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|ReactiveExecutor
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|re
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setReactiveExecutor
argument_list|(
name|re
argument_list|)
expr_stmt|;
block|}
name|ShutdownStrategy
name|ss
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|ShutdownStrategy
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|ss
operator|!=
literal|null
condition|)
block|{
name|ecc
operator|.
name|setShutdownStrategy
argument_list|(
name|ss
argument_list|)
expr_stmt|;
block|}
name|Set
argument_list|<
name|TypeConverters
argument_list|>
name|tcs
init|=
name|registry
operator|.
name|findByType
argument_list|(
name|TypeConverters
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|tcs
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|tcs
operator|.
name|forEach
argument_list|(
name|t
lambda|->
name|camelContext
operator|.
name|getTypeConverterRegistry
argument_list|()
operator|.
name|addTypeConverters
argument_list|(
name|t
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|Set
argument_list|<
name|EndpointStrategy
argument_list|>
name|ess
init|=
name|registry
operator|.
name|findByType
argument_list|(
name|EndpointStrategy
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|ess
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|ess
operator|.
name|forEach
argument_list|(
name|ecc
operator|::
name|registerEndpointCallback
argument_list|)
expr_stmt|;
block|}
name|Set
argument_list|<
name|CamelClusterService
argument_list|>
name|csss
init|=
name|registry
operator|.
name|findByType
argument_list|(
name|CamelClusterService
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|csss
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
for|for
control|(
name|CamelClusterService
name|css
range|:
name|csss
control|)
block|{
name|camelContext
operator|.
name|addService
argument_list|(
name|css
argument_list|)
expr_stmt|;
block|}
block|}
name|Set
argument_list|<
name|RoutePolicyFactory
argument_list|>
name|rpfs
init|=
name|registry
operator|.
name|findByType
argument_list|(
name|RoutePolicyFactory
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|rpfs
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|rpfs
operator|.
name|forEach
argument_list|(
name|camelContext
operator|::
name|addRoutePolicyFactory
argument_list|)
expr_stmt|;
block|}
specifier|final
name|Predicate
argument_list|<
name|EventNotifier
argument_list|>
name|containsEventNotifier
init|=
name|managementStrategy
operator|.
name|getEventNotifiers
argument_list|()
operator|::
name|contains
decl_stmt|;
name|registerPropertiesForBeanTypesWithCondition
argument_list|(
name|registry
argument_list|,
name|EventNotifier
operator|.
name|class
argument_list|,
name|containsEventNotifier
operator|.
name|negate
argument_list|()
argument_list|,
name|managementStrategy
operator|::
name|addEventNotifier
argument_list|)
expr_stmt|;
specifier|final
name|Predicate
argument_list|<
name|InterceptStrategy
argument_list|>
name|containsInterceptStrategy
init|=
name|camelContext
operator|.
name|adapt
argument_list|(
name|ExtendedCamelContext
operator|.
name|class
argument_list|)
operator|.
name|getInterceptStrategies
argument_list|()
operator|::
name|contains
decl_stmt|;
name|registerPropertiesForBeanTypesWithCondition
argument_list|(
name|registry
argument_list|,
name|InterceptStrategy
operator|.
name|class
argument_list|,
name|containsInterceptStrategy
operator|.
name|negate
argument_list|()
argument_list|,
name|camelContext
operator|.
name|adapt
argument_list|(
name|ExtendedCamelContext
operator|.
name|class
argument_list|)
operator|::
name|addInterceptStrategy
argument_list|)
expr_stmt|;
specifier|final
name|Predicate
argument_list|<
name|LifecycleStrategy
argument_list|>
name|containsLifecycleStrategy
init|=
name|camelContext
operator|.
name|getLifecycleStrategies
argument_list|()
operator|::
name|contains
decl_stmt|;
name|registerPropertiesForBeanTypesWithCondition
argument_list|(
name|registry
argument_list|,
name|LifecycleStrategy
operator|.
name|class
argument_list|,
name|containsLifecycleStrategy
operator|.
name|negate
argument_list|()
argument_list|,
name|camelContext
operator|::
name|addLifecycleStrategy
argument_list|)
expr_stmt|;
specifier|final
name|Predicate
argument_list|<
name|LogListener
argument_list|>
name|containsLogListener
init|=
name|camelContext
operator|.
name|adapt
argument_list|(
name|ExtendedCamelContext
operator|.
name|class
argument_list|)
operator|.
name|getLogListeners
argument_list|()
operator|::
name|contains
decl_stmt|;
name|registerPropertiesForBeanTypesWithCondition
argument_list|(
name|registry
argument_list|,
name|LogListener
operator|.
name|class
argument_list|,
name|containsLogListener
operator|.
name|negate
argument_list|()
argument_list|,
name|camelContext
operator|.
name|adapt
argument_list|(
name|ExtendedCamelContext
operator|.
name|class
argument_list|)
operator|::
name|addLogListener
argument_list|)
expr_stmt|;
comment|// service registry
name|Map
argument_list|<
name|String
argument_list|,
name|ServiceRegistry
argument_list|>
name|serviceRegistries
init|=
name|registry
operator|.
name|findByTypeWithName
argument_list|(
name|ServiceRegistry
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|serviceRegistries
operator|!=
literal|null
operator|&&
operator|!
name|serviceRegistries
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
for|for
control|(
name|Map
operator|.
name|Entry
argument_list|<
name|String
argument_list|,
name|ServiceRegistry
argument_list|>
name|entry
range|:
name|serviceRegistries
operator|.
name|entrySet
argument_list|()
control|)
block|{
name|ServiceRegistry
name|service
init|=
name|entry
operator|.
name|getValue
argument_list|()
decl_stmt|;
if|if
condition|(
name|service
operator|.
name|getId
argument_list|()
operator|==
literal|null
condition|)
block|{
name|service
operator|.
name|setId
argument_list|(
name|camelContext
operator|.
name|getUuidGenerator
argument_list|()
operator|.
name|generateUuid
argument_list|()
argument_list|)
expr_stmt|;
block|}
name|LOG
operator|.
name|info
argument_list|(
literal|"Using ServiceRegistry with id: {} and implementation: {}"
argument_list|,
name|service
operator|.
name|getId
argument_list|()
argument_list|,
name|service
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|addService
argument_list|(
name|service
argument_list|)
expr_stmt|;
block|}
block|}
comment|// SSL context parameters
name|GlobalSSLContextParametersSupplier
name|sslContextParametersSupplier
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|GlobalSSLContextParametersSupplier
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|sslContextParametersSupplier
operator|!=
literal|null
condition|)
block|{
name|camelContext
operator|.
name|setSSLContextParameters
argument_list|(
name|sslContextParametersSupplier
operator|.
name|get
argument_list|()
argument_list|)
expr_stmt|;
block|}
comment|// health check
name|HealthCheckRegistry
name|healthCheckRegistry
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|HealthCheckRegistry
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|healthCheckRegistry
operator|!=
literal|null
condition|)
block|{
name|healthCheckRegistry
operator|.
name|setCamelContext
argument_list|(
name|camelContext
argument_list|)
expr_stmt|;
name|LOG
operator|.
name|info
argument_list|(
literal|"Using HealthCheckRegistry: {}"
argument_list|,
name|healthCheckRegistry
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|setExtension
argument_list|(
name|HealthCheckRegistry
operator|.
name|class
argument_list|,
name|healthCheckRegistry
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|healthCheckRegistry
operator|=
name|HealthCheckRegistry
operator|.
name|get
argument_list|(
name|camelContext
argument_list|)
expr_stmt|;
name|healthCheckRegistry
operator|.
name|setCamelContext
argument_list|(
name|camelContext
argument_list|)
expr_stmt|;
block|}
name|Set
argument_list|<
name|HealthCheckRepository
argument_list|>
name|hcrs
init|=
name|registry
operator|.
name|findByType
argument_list|(
name|HealthCheckRepository
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|hcrs
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
name|hcrs
operator|.
name|forEach
argument_list|(
name|healthCheckRegistry
operator|::
name|addRepository
argument_list|)
expr_stmt|;
block|}
name|HealthCheckService
name|hcs
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|HealthCheckService
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|hcs
operator|!=
literal|null
condition|)
block|{
name|camelContext
operator|.
name|addService
argument_list|(
name|hcs
argument_list|)
expr_stmt|;
block|}
comment|// set the default thread pool profile if defined
name|initThreadPoolProfiles
argument_list|(
name|registry
argument_list|,
name|camelContext
argument_list|)
expr_stmt|;
block|}
DECL|method|registerPropertyForBeanType (final Registry registry, final Class<T> beanType, final Consumer<T> propertySetter)
specifier|private
specifier|static
parameter_list|<
name|T
parameter_list|>
name|void
name|registerPropertyForBeanType
parameter_list|(
specifier|final
name|Registry
name|registry
parameter_list|,
specifier|final
name|Class
argument_list|<
name|T
argument_list|>
name|beanType
parameter_list|,
specifier|final
name|Consumer
argument_list|<
name|T
argument_list|>
name|propertySetter
parameter_list|)
block|{
name|T
name|propertyBean
init|=
name|getSingleBeanOfType
argument_list|(
name|registry
argument_list|,
name|beanType
argument_list|)
decl_stmt|;
if|if
condition|(
name|propertyBean
operator|==
literal|null
condition|)
block|{
return|return;
block|}
name|LOG
operator|.
name|info
argument_list|(
literal|"Using custom {}: {}"
argument_list|,
name|beanType
operator|.
name|getSimpleName
argument_list|()
argument_list|,
name|propertyBean
argument_list|)
expr_stmt|;
name|propertySetter
operator|.
name|accept
argument_list|(
name|propertyBean
argument_list|)
expr_stmt|;
block|}
DECL|method|getSingleBeanOfType (Registry registry, Class<T> type)
specifier|private
specifier|static
parameter_list|<
name|T
parameter_list|>
name|T
name|getSingleBeanOfType
parameter_list|(
name|Registry
name|registry
parameter_list|,
name|Class
argument_list|<
name|T
argument_list|>
name|type
parameter_list|)
block|{
name|Map
argument_list|<
name|String
argument_list|,
name|T
argument_list|>
name|beans
init|=
name|registry
operator|.
name|findByTypeWithName
argument_list|(
name|type
argument_list|)
decl_stmt|;
if|if
condition|(
name|beans
operator|.
name|size
argument_list|()
operator|==
literal|1
condition|)
block|{
return|return
name|beans
operator|.
name|values
argument_list|()
operator|.
name|iterator
argument_list|()
operator|.
name|next
argument_list|()
return|;
block|}
else|else
block|{
return|return
literal|null
return|;
block|}
block|}
DECL|method|registerPropertiesForBeanTypes (final Registry registry, final Class<T> beanType, final Consumer<T> propertySetter)
specifier|private
specifier|static
parameter_list|<
name|T
parameter_list|>
name|void
name|registerPropertiesForBeanTypes
parameter_list|(
specifier|final
name|Registry
name|registry
parameter_list|,
specifier|final
name|Class
argument_list|<
name|T
argument_list|>
name|beanType
parameter_list|,
specifier|final
name|Consumer
argument_list|<
name|T
argument_list|>
name|propertySetter
parameter_list|)
block|{
name|registerPropertiesForBeanTypesWithCondition
argument_list|(
name|registry
argument_list|,
name|beanType
argument_list|,
name|b
lambda|->
literal|true
argument_list|,
name|propertySetter
argument_list|)
expr_stmt|;
block|}
DECL|method|registerPropertiesForBeanTypesWithCondition (final Registry registry, final Class<T> beanType, final Predicate<T> condition, final Consumer<T> propertySetter)
specifier|private
specifier|static
parameter_list|<
name|T
parameter_list|>
name|void
name|registerPropertiesForBeanTypesWithCondition
parameter_list|(
specifier|final
name|Registry
name|registry
parameter_list|,
specifier|final
name|Class
argument_list|<
name|T
argument_list|>
name|beanType
parameter_list|,
specifier|final
name|Predicate
argument_list|<
name|T
argument_list|>
name|condition
parameter_list|,
specifier|final
name|Consumer
argument_list|<
name|T
argument_list|>
name|propertySetter
parameter_list|)
block|{
specifier|final
name|Map
argument_list|<
name|String
argument_list|,
name|T
argument_list|>
name|beans
init|=
name|registry
operator|.
name|findByTypeWithName
argument_list|(
name|beanType
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|ObjectHelper
operator|.
name|isNotEmpty
argument_list|(
name|beans
argument_list|)
condition|)
block|{
return|return;
block|}
specifier|final
name|String
name|simpleName
init|=
name|beanType
operator|.
name|getSimpleName
argument_list|()
decl_stmt|;
name|beans
operator|.
name|forEach
argument_list|(
parameter_list|(
name|name
parameter_list|,
name|bean
parameter_list|)
lambda|->
block|{
if|if
condition|(
name|condition
operator|.
name|test
argument_list|(
name|bean
argument_list|)
condition|)
block|{
name|LOG
operator|.
name|info
argument_list|(
literal|"Adding custom {} with id: {} and implementation: {}"
argument_list|,
name|simpleName
argument_list|,
name|name
argument_list|,
name|bean
argument_list|)
expr_stmt|;
name|propertySetter
operator|.
name|accept
argument_list|(
name|bean
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
block|}
DECL|method|addServiceToContext (final CamelContext camelContext)
specifier|private
specifier|static
parameter_list|<
name|T
parameter_list|>
name|Consumer
argument_list|<
name|T
argument_list|>
name|addServiceToContext
parameter_list|(
specifier|final
name|CamelContext
name|camelContext
parameter_list|)
block|{
return|return
name|service
lambda|->
block|{
try|try
block|{
name|camelContext
operator|.
name|addService
argument_list|(
name|service
argument_list|)
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|Exception
name|e
parameter_list|)
block|{
throw|throw
operator|new
name|RuntimeException
argument_list|(
literal|"Unable to add service to Camel context"
argument_list|,
name|e
argument_list|)
throw|;
block|}
block|}
return|;
block|}
DECL|method|initThreadPoolProfiles (Registry registry, CamelContext camelContext)
specifier|private
specifier|static
name|void
name|initThreadPoolProfiles
parameter_list|(
name|Registry
name|registry
parameter_list|,
name|CamelContext
name|camelContext
parameter_list|)
block|{
name|Set
argument_list|<
name|String
argument_list|>
name|defaultIds
init|=
operator|new
name|HashSet
argument_list|<>
argument_list|()
decl_stmt|;
comment|// lookup and use custom profiles from the registry
name|Map
argument_list|<
name|String
argument_list|,
name|ThreadPoolProfile
argument_list|>
name|profiles
init|=
name|registry
operator|.
name|findByTypeWithName
argument_list|(
name|ThreadPoolProfile
operator|.
name|class
argument_list|)
decl_stmt|;
if|if
condition|(
name|profiles
operator|!=
literal|null
operator|&&
operator|!
name|profiles
operator|.
name|isEmpty
argument_list|()
condition|)
block|{
for|for
control|(
name|Map
operator|.
name|Entry
argument_list|<
name|String
argument_list|,
name|ThreadPoolProfile
argument_list|>
name|entry
range|:
name|profiles
operator|.
name|entrySet
argument_list|()
control|)
block|{
name|ThreadPoolProfile
name|profile
init|=
name|entry
operator|.
name|getValue
argument_list|()
decl_stmt|;
comment|// do not add if already added, for instance a tracer that is also an InterceptStrategy class
if|if
condition|(
name|profile
operator|.
name|isDefaultProfile
argument_list|()
condition|)
block|{
name|LOG
operator|.
name|info
argument_list|(
literal|"Using custom default ThreadPoolProfile with id: {} and implementation: {}"
argument_list|,
name|entry
operator|.
name|getKey
argument_list|()
argument_list|,
name|profile
argument_list|)
expr_stmt|;
name|camelContext
operator|.
name|getExecutorServiceManager
argument_list|()
operator|.
name|setDefaultThreadPoolProfile
argument_list|(
name|profile
argument_list|)
expr_stmt|;
name|defaultIds
operator|.
name|add
argument_list|(
name|entry
operator|.
name|getKey
argument_list|()
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|camelContext
operator|.
name|getExecutorServiceManager
argument_list|()
operator|.
name|registerThreadPoolProfile
argument_list|(
name|profile
argument_list|)
expr_stmt|;
block|}
block|}
block|}
comment|// validate at most one is defined
if|if
condition|(
name|defaultIds
operator|.
name|size
argument_list|()
operator|>
literal|1
condition|)
block|{
throw|throw
operator|new
name|IllegalArgumentException
argument_list|(
literal|"Only exactly one default ThreadPoolProfile is allowed, was "
operator|+
name|defaultIds
operator|.
name|size
argument_list|()
operator|+
literal|" ids: "
operator|+
name|defaultIds
argument_list|)
throw|;
block|}
block|}
block|}
end_class

end_unit


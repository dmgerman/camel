begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  * Licensed to the Apache Software Foundation (ASF) under one or more  * contributor license agreements.  See the NOTICE file distributed with  * this work for additional information regarding copyright ownership.  * The ASF licenses this file to You under the Apache License, Version 2.0  * (the "License"); you may not use this file except in compliance with  * the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
DECL|package|org.apache.camel.component.kafka
package|package
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|component
operator|.
name|kafka
package|;
end_package

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashMap
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Map
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Properties
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|CamelContext
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|support
operator|.
name|jsse
operator|.
name|KeyStoreParameters
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|support
operator|.
name|jsse
operator|.
name|SSLContextParameters
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|support
operator|.
name|jsse
operator|.
name|TrustManagersParameters
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|kafka
operator|.
name|clients
operator|.
name|CommonClientConfigs
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|kafka
operator|.
name|clients
operator|.
name|producer
operator|.
name|ProducerConfig
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|kafka
operator|.
name|common
operator|.
name|config
operator|.
name|SaslConfigs
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|kafka
operator|.
name|common
operator|.
name|config
operator|.
name|SslConfigs
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Test
import|;
end_import

begin_import
import|import
name|org
operator|.
name|mockito
operator|.
name|Mockito
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|junit
operator|.
name|Assert
operator|.
name|assertEquals
import|;
end_import

begin_import
import|import static
name|org
operator|.
name|junit
operator|.
name|Assert
operator|.
name|assertNull
import|;
end_import

begin_class
DECL|class|KafkaComponentTest
specifier|public
class|class
name|KafkaComponentTest
block|{
DECL|field|context
specifier|private
name|CamelContext
name|context
init|=
name|Mockito
operator|.
name|mock
argument_list|(
name|CamelContext
operator|.
name|class
argument_list|)
decl_stmt|;
annotation|@
name|Test
DECL|method|testPropertiesSet ()
specifier|public
name|void
name|testPropertiesSet
parameter_list|()
throws|throws
name|Exception
block|{
name|String
name|uri
init|=
literal|"kafka:mytopic?brokers=broker1:12345,broker2:12566&partitioner=com.class.Party"
decl_stmt|;
name|KafkaEndpoint
name|endpoint
init|=
operator|(
name|KafkaEndpoint
operator|)
operator|new
name|KafkaComponent
argument_list|(
name|context
argument_list|)
operator|.
name|createEndpoint
argument_list|(
name|uri
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|"broker1:12345,broker2:12566"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getBrokers
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"mytopic"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getTopic
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"com.class.Party"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getPartitioner
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testBrokersOnComponent ()
specifier|public
name|void
name|testBrokersOnComponent
parameter_list|()
throws|throws
name|Exception
block|{
name|KafkaComponent
name|kafka
init|=
operator|new
name|KafkaComponent
argument_list|(
name|context
argument_list|)
decl_stmt|;
name|kafka
operator|.
name|setBrokers
argument_list|(
literal|"broker1:12345,broker2:12566"
argument_list|)
expr_stmt|;
name|String
name|uri
init|=
literal|"kafka:mytopic?partitioner=com.class.Party"
decl_stmt|;
name|KafkaEndpoint
name|endpoint
init|=
operator|(
name|KafkaEndpoint
operator|)
name|kafka
operator|.
name|createEndpoint
argument_list|(
name|uri
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|"broker1:12345,broker2:12566"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getBrokers
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"broker1:12345,broker2:12566"
argument_list|,
name|endpoint
operator|.
name|getComponent
argument_list|()
operator|.
name|getBrokers
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"mytopic"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getTopic
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"com.class.Party"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getPartitioner
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAllProducerConfigProperty ()
specifier|public
name|void
name|testAllProducerConfigProperty
parameter_list|()
throws|throws
name|Exception
block|{
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|params
init|=
operator|new
name|HashMap
argument_list|<>
argument_list|()
decl_stmt|;
name|setProducerProperty
argument_list|(
name|params
argument_list|)
expr_stmt|;
name|String
name|uri
init|=
literal|"kafka:mytopic?brokers=dev1:12345,dev2:12566"
decl_stmt|;
name|String
name|remaining
init|=
literal|"mytopic"
decl_stmt|;
name|KafkaEndpoint
name|endpoint
init|=
operator|new
name|KafkaComponent
argument_list|(
name|context
argument_list|)
operator|.
name|createEndpoint
argument_list|(
name|uri
argument_list|,
name|remaining
argument_list|,
name|params
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
literal|"mytopic"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getTopic
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"1"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getRequestRequiredAcks
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|1
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getBufferMemorySize
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|10
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getProducerBatchSize
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|12
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getConnectionMaxIdleMs
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|1
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getMaxBlockMs
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|1
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getBufferMemorySize
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"testing"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getClientId
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"none"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getCompressionCodec
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|1
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getLingerMs
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|100
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getMaxRequestSize
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|100
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getRequestTimeoutMs
argument_list|()
operator|.
name|intValue
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|1029
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getMetadataMaxAgeMs
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|23
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getReceiveBufferBytes
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|234
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getReconnectBackoffMs
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|234
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getReconnectBackoffMaxMs
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|0
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getRetries
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|3782
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getRetryBackoffMs
argument_list|()
operator|.
name|intValue
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|765
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSendBufferBytes
argument_list|()
operator|.
name|intValue
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|1
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getMaxInFlightRequest
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"org.apache.camel.reporters.TestReport,org.apache.camel.reporters.SampleReport"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getMetricReporters
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|3
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getNoOfMetricsSample
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|12344
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getMetricsSampleWindowMs
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|KafkaConstants
operator|.
name|KAFKA_DEFAULT_SERIALIZER
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSerializerClass
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
name|KafkaConstants
operator|.
name|KAFKA_DEFAULT_SERIALIZER
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getKeySerializerClass
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"testing"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSslKeyPassword
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"/abc"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSslKeystoreLocation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"testing"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSslKeystorePassword
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"/abc"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSslTruststoreLocation
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"testing"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSslTruststorePassword
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"test"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSaslKerberosServiceName
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"PLAINTEXT"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSecurityProtocol
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"TLSv1.2"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSslEnabledProtocols
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"JKS"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSslKeystoreType
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"TLS"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSslProtocol
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"test"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSslProvider
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"JKS"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSslTruststoreType
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"/usr/bin/kinit"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getKerberosInitCmd
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Integer
argument_list|(
literal|60000
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getKerberosBeforeReloginMinTime
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Double
argument_list|(
literal|0.05
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getKerberosRenewJitter
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
operator|new
name|Double
argument_list|(
literal|0.8
argument_list|)
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getKerberosRenewWindowFactor
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"MAC"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSslCipherSuites
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"test"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSslEndpointAlgorithm
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"SunX509"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSslKeymanagerAlgorithm
argument_list|()
argument_list|)
expr_stmt|;
name|assertEquals
argument_list|(
literal|"PKIX"
argument_list|,
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|getSslTrustmanagerAlgorithm
argument_list|()
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testAllProducerKeys ()
specifier|public
name|void
name|testAllProducerKeys
parameter_list|()
throws|throws
name|Exception
block|{
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|params
init|=
operator|new
name|HashMap
argument_list|<>
argument_list|()
decl_stmt|;
name|String
name|uri
init|=
literal|"kafka:mytopic?brokers=dev1:12345,dev2:12566"
decl_stmt|;
name|String
name|remaining
init|=
literal|"mytopic"
decl_stmt|;
name|KafkaEndpoint
name|endpoint
init|=
operator|new
name|KafkaComponent
argument_list|(
name|context
argument_list|)
operator|.
name|createEndpoint
argument_list|(
name|uri
argument_list|,
name|remaining
argument_list|,
name|params
argument_list|)
decl_stmt|;
name|assertEquals
argument_list|(
name|endpoint
operator|.
name|getConfiguration
argument_list|()
operator|.
name|createProducerProperties
argument_list|()
operator|.
name|keySet
argument_list|()
argument_list|,
name|getProducerKeys
argument_list|()
operator|.
name|keySet
argument_list|()
argument_list|)
expr_stmt|;
block|}
DECL|method|getProducerKeys ()
specifier|private
name|Properties
name|getProducerKeys
parameter_list|()
block|{
name|Properties
name|props
init|=
operator|new
name|Properties
argument_list|()
decl_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|ACKS_CONFIG
argument_list|,
literal|"1"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|BUFFER_MEMORY_CONFIG
argument_list|,
literal|"33554432"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|COMPRESSION_TYPE_CONFIG
argument_list|,
literal|"none"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|RETRIES_CONFIG
argument_list|,
literal|"0"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|BATCH_SIZE_CONFIG
argument_list|,
literal|"16384"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|CONNECTIONS_MAX_IDLE_MS_CONFIG
argument_list|,
literal|"540000"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|LINGER_MS_CONFIG
argument_list|,
literal|"0"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|MAX_BLOCK_MS_CONFIG
argument_list|,
literal|"60000"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|MAX_REQUEST_SIZE_CONFIG
argument_list|,
literal|"1048576"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|PARTITIONER_CLASS_CONFIG
argument_list|,
name|KafkaConstants
operator|.
name|KAFKA_DEFAULT_PARTITIONER
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|RECEIVE_BUFFER_CONFIG
argument_list|,
literal|"32768"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|REQUEST_TIMEOUT_MS_CONFIG
argument_list|,
literal|"30000"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|SEND_BUFFER_CONFIG
argument_list|,
literal|"131072"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION
argument_list|,
literal|"5"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|METADATA_MAX_AGE_CONFIG
argument_list|,
literal|"300000"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|METRICS_NUM_SAMPLES_CONFIG
argument_list|,
literal|"2"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|METRICS_SAMPLE_WINDOW_MS_CONFIG
argument_list|,
literal|"30000"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|RECONNECT_BACKOFF_MS_CONFIG
argument_list|,
literal|"50"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|RECONNECT_BACKOFF_MAX_MS_CONFIG
argument_list|,
literal|"1000"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|RETRY_BACKOFF_MS_CONFIG
argument_list|,
literal|"100"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|VALUE_SERIALIZER_CLASS_CONFIG
argument_list|,
name|KafkaConstants
operator|.
name|KAFKA_DEFAULT_SERIALIZER
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|KEY_SERIALIZER_CLASS_CONFIG
argument_list|,
name|KafkaConstants
operator|.
name|KAFKA_DEFAULT_SERIALIZER
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|ProducerConfig
operator|.
name|ENABLE_IDEMPOTENCE_CONFIG
argument_list|,
literal|"false"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|CommonClientConfigs
operator|.
name|SECURITY_PROTOCOL_CONFIG
argument_list|,
literal|"PLAINTEXT"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|SslConfigs
operator|.
name|SSL_ENABLED_PROTOCOLS_CONFIG
argument_list|,
literal|"TLSv1.2, TLSv1.1, TLSv1"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|SslConfigs
operator|.
name|SSL_KEYSTORE_TYPE_CONFIG
argument_list|,
literal|"JKS"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|SslConfigs
operator|.
name|SSL_PROTOCOL_CONFIG
argument_list|,
literal|"TLS"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|SslConfigs
operator|.
name|SSL_TRUSTSTORE_TYPE_CONFIG
argument_list|,
literal|"JKS"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|SaslConfigs
operator|.
name|SASL_KERBEROS_KINIT_CMD
argument_list|,
literal|"/usr/bin/kinit"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|SaslConfigs
operator|.
name|SASL_KERBEROS_MIN_TIME_BEFORE_RELOGIN
argument_list|,
literal|"60000"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|SaslConfigs
operator|.
name|SASL_KERBEROS_TICKET_RENEW_JITTER
argument_list|,
literal|"0.05"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|SaslConfigs
operator|.
name|SASL_KERBEROS_TICKET_RENEW_WINDOW_FACTOR
argument_list|,
literal|"0.8"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|SaslConfigs
operator|.
name|SASL_MECHANISM
argument_list|,
literal|"PLAIN"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|SslConfigs
operator|.
name|SSL_KEYMANAGER_ALGORITHM_CONFIG
argument_list|,
literal|"SunX509"
argument_list|)
expr_stmt|;
name|props
operator|.
name|put
argument_list|(
name|SslConfigs
operator|.
name|SSL_TRUSTMANAGER_ALGORITHM_CONFIG
argument_list|,
literal|"PKIX"
argument_list|)
expr_stmt|;
return|return
name|props
return|;
block|}
DECL|method|setProducerProperty (Map<String, Object> params)
specifier|private
name|void
name|setProducerProperty
parameter_list|(
name|Map
argument_list|<
name|String
argument_list|,
name|Object
argument_list|>
name|params
parameter_list|)
block|{
name|params
operator|.
name|put
argument_list|(
literal|"requestRequiredAcks"
argument_list|,
literal|"1"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"bufferMemorySize"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"compressionCodec"
argument_list|,
literal|"none"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"retries"
argument_list|,
literal|0
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"producerBatchSize"
argument_list|,
literal|10
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"connectionMaxIdleMs"
argument_list|,
literal|12
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"lingerMs"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"maxBlockMs"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"maxRequestSize"
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"receiveBufferBytes"
argument_list|,
literal|23
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"requestTimeoutMs"
argument_list|,
literal|100
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sendBufferBytes"
argument_list|,
literal|765
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"timeoutMs"
argument_list|,
literal|2045
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"blockOnBufferFull"
argument_list|,
literal|false
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"maxInFlightRequest"
argument_list|,
literal|1
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"metadataFetchTimeoutMs"
argument_list|,
literal|9043
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"metadataMaxAgeMs"
argument_list|,
literal|1029
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"reconnectBackoffMs"
argument_list|,
literal|234
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"reconnectBackoffMaxMs"
argument_list|,
literal|234
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"retryBackoffMs"
argument_list|,
literal|3782
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"noOfMetricsSample"
argument_list|,
literal|3
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"metricReporters"
argument_list|,
literal|"org.apache.camel.reporters.TestReport,org.apache.camel.reporters.SampleReport"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"metricsSampleWindowMs"
argument_list|,
literal|12344
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"clientId"
argument_list|,
literal|"testing"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sslKeyPassword"
argument_list|,
literal|"testing"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sslKeystoreLocation"
argument_list|,
literal|"/abc"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sslKeystorePassword"
argument_list|,
literal|"testing"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sslTruststoreLocation"
argument_list|,
literal|"/abc"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sslTruststorePassword"
argument_list|,
literal|"testing"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"saslKerberosServiceName"
argument_list|,
literal|"test"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"saslMechanism"
argument_list|,
literal|"PLAIN"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"securityProtocol"
argument_list|,
literal|"PLAINTEXT"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sslEnabledProtocols"
argument_list|,
literal|"TLSv1.2"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sslKeystoreType"
argument_list|,
literal|"JKS"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sslProtocol"
argument_list|,
literal|"TLS"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sslProvider"
argument_list|,
literal|"test"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sslTruststoreType"
argument_list|,
literal|"JKS"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"kerberosInitCmd"
argument_list|,
literal|"/usr/bin/kinit"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"kerberosBeforeReloginMinTime"
argument_list|,
literal|60000
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"kerberosRenewJitter"
argument_list|,
literal|0.05
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"kerberosRenewWindowFactor"
argument_list|,
literal|0.8
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sslCipherSuites"
argument_list|,
literal|"MAC"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sslEndpointAlgorithm"
argument_list|,
literal|"test"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sslKeymanagerAlgorithm"
argument_list|,
literal|"SunX509"
argument_list|)
expr_stmt|;
name|params
operator|.
name|put
argument_list|(
literal|"sslTrustmanagerAlgorithm"
argument_list|,
literal|"PKIX"
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testCreateProducerConfigTruststorePassword ()
specifier|public
name|void
name|testCreateProducerConfigTruststorePassword
parameter_list|()
throws|throws
name|Exception
block|{
name|KeyStoreParameters
name|keyStoreParameters
init|=
operator|new
name|KeyStoreParameters
argument_list|()
decl_stmt|;
name|keyStoreParameters
operator|.
name|setPassword
argument_list|(
literal|"my-password"
argument_list|)
expr_stmt|;
name|TrustManagersParameters
name|trustManagersParameters
init|=
operator|new
name|TrustManagersParameters
argument_list|()
decl_stmt|;
name|trustManagersParameters
operator|.
name|setKeyStore
argument_list|(
name|keyStoreParameters
argument_list|)
expr_stmt|;
name|SSLContextParameters
name|sslContextParameters
init|=
operator|new
name|SSLContextParameters
argument_list|()
decl_stmt|;
name|sslContextParameters
operator|.
name|setTrustManagers
argument_list|(
name|trustManagersParameters
argument_list|)
expr_stmt|;
name|KafkaConfiguration
name|kcfg
init|=
operator|new
name|KafkaConfiguration
argument_list|()
decl_stmt|;
name|kcfg
operator|.
name|setSslContextParameters
argument_list|(
name|sslContextParameters
argument_list|)
expr_stmt|;
name|Properties
name|props
init|=
name|kcfg
operator|.
name|createProducerProperties
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
literal|"my-password"
argument_list|,
name|props
operator|.
name|getProperty
argument_list|(
literal|"ssl.truststore.password"
argument_list|)
argument_list|)
expr_stmt|;
name|assertNull
argument_list|(
name|props
operator|.
name|getProperty
argument_list|(
literal|"ssl.keystore.password"
argument_list|)
argument_list|)
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testCreateConsumerConfigTruststorePassword ()
specifier|public
name|void
name|testCreateConsumerConfigTruststorePassword
parameter_list|()
throws|throws
name|Exception
block|{
name|KeyStoreParameters
name|keyStoreParameters
init|=
operator|new
name|KeyStoreParameters
argument_list|()
decl_stmt|;
name|keyStoreParameters
operator|.
name|setPassword
argument_list|(
literal|"my-password"
argument_list|)
expr_stmt|;
name|TrustManagersParameters
name|trustManagersParameters
init|=
operator|new
name|TrustManagersParameters
argument_list|()
decl_stmt|;
name|trustManagersParameters
operator|.
name|setKeyStore
argument_list|(
name|keyStoreParameters
argument_list|)
expr_stmt|;
name|SSLContextParameters
name|sslContextParameters
init|=
operator|new
name|SSLContextParameters
argument_list|()
decl_stmt|;
name|sslContextParameters
operator|.
name|setTrustManagers
argument_list|(
name|trustManagersParameters
argument_list|)
expr_stmt|;
name|KafkaConfiguration
name|kcfg
init|=
operator|new
name|KafkaConfiguration
argument_list|()
decl_stmt|;
name|kcfg
operator|.
name|setSslContextParameters
argument_list|(
name|sslContextParameters
argument_list|)
expr_stmt|;
name|Properties
name|props
init|=
name|kcfg
operator|.
name|createConsumerProperties
argument_list|()
decl_stmt|;
name|assertEquals
argument_list|(
literal|"my-password"
argument_list|,
name|props
operator|.
name|getProperty
argument_list|(
literal|"ssl.truststore.password"
argument_list|)
argument_list|)
expr_stmt|;
name|assertNull
argument_list|(
name|props
operator|.
name|getProperty
argument_list|(
literal|"ssl.keystore.password"
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
end_class

end_unit


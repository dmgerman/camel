begin_unit|revision:0.9.5;language:Java;cregit-version:0.0.1
begin_comment
comment|/*  * Licensed to the Apache Software Foundation (ASF) under one or more  * contributor license agreements.  See the NOTICE file distributed with  * this work for additional information regarding copyright ownership.  * The ASF licenses this file to You under the Apache License, Version 2.0  * (the "License"); you may not use this file except in compliance with  * the License.  You may obtain a copy of the License at  *  *      http://www.apache.org/licenses/LICENSE-2.0  *  * Unless required by applicable law or agreed to in writing, software  * distributed under the License is distributed on an "AS IS" BASIS,  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  * See the License for the specific language governing permissions and  * limitations under the License.  */
end_comment

begin_package
DECL|package|org.apache.camel.coap
package|package
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|coap
package|;
end_package

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|security
operator|.
name|GeneralSecurityException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|security
operator|.
name|KeyStore
import|;
end_import

begin_import
import|import
name|java
operator|.
name|security
operator|.
name|PrivateKey
import|;
end_import

begin_import
import|import
name|java
operator|.
name|security
operator|.
name|PublicKey
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|crypto
operator|.
name|KeyGenerator
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|Exchange
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|Message
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|Processor
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|builder
operator|.
name|RouteBuilder
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|component
operator|.
name|mock
operator|.
name|MockEndpoint
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|support
operator|.
name|jsse
operator|.
name|KeyManagersParameters
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|support
operator|.
name|jsse
operator|.
name|KeyStoreParameters
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|support
operator|.
name|jsse
operator|.
name|SSLContextParameters
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|support
operator|.
name|jsse
operator|.
name|SSLContextServerParameters
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|support
operator|.
name|jsse
operator|.
name|TrustManagersParameters
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|test
operator|.
name|AvailablePortFinder
import|;
end_import

begin_import
import|import
name|org
operator|.
name|apache
operator|.
name|camel
operator|.
name|test
operator|.
name|junit4
operator|.
name|CamelTestSupport
import|;
end_import

begin_import
import|import
name|org
operator|.
name|eclipse
operator|.
name|californium
operator|.
name|core
operator|.
name|coap
operator|.
name|CoAP
import|;
end_import

begin_import
import|import
name|org
operator|.
name|eclipse
operator|.
name|californium
operator|.
name|core
operator|.
name|coap
operator|.
name|MediaTypeRegistry
import|;
end_import

begin_import
import|import
name|org
operator|.
name|eclipse
operator|.
name|californium
operator|.
name|scandium
operator|.
name|dtls
operator|.
name|pskstore
operator|.
name|PskStore
import|;
end_import

begin_import
import|import
name|org
operator|.
name|eclipse
operator|.
name|californium
operator|.
name|scandium
operator|.
name|dtls
operator|.
name|pskstore
operator|.
name|StaticPskStore
import|;
end_import

begin_import
import|import
name|org
operator|.
name|eclipse
operator|.
name|californium
operator|.
name|scandium
operator|.
name|dtls
operator|.
name|rpkstore
operator|.
name|TrustedRpkStore
import|;
end_import

begin_import
import|import
name|org
operator|.
name|junit
operator|.
name|Test
import|;
end_import

begin_class
DECL|class|CoAPComponentTLSTest
specifier|public
class|class
name|CoAPComponentTLSTest
extends|extends
name|CamelTestSupport
block|{
DECL|field|PORT
specifier|private
specifier|static
specifier|final
name|int
name|PORT
init|=
name|AvailablePortFinder
operator|.
name|getNextAvailable
argument_list|()
decl_stmt|;
DECL|field|PORT2
specifier|private
specifier|static
specifier|final
name|int
name|PORT2
init|=
name|AvailablePortFinder
operator|.
name|getNextAvailable
argument_list|()
decl_stmt|;
DECL|field|PORT3
specifier|private
specifier|static
specifier|final
name|int
name|PORT3
init|=
name|AvailablePortFinder
operator|.
name|getNextAvailable
argument_list|()
decl_stmt|;
DECL|field|PORT4
specifier|private
specifier|static
specifier|final
name|int
name|PORT4
init|=
name|AvailablePortFinder
operator|.
name|getNextAvailable
argument_list|()
decl_stmt|;
DECL|field|PORT5
specifier|private
specifier|static
specifier|final
name|int
name|PORT5
init|=
name|AvailablePortFinder
operator|.
name|getNextAvailable
argument_list|()
decl_stmt|;
DECL|field|PORT6
specifier|private
specifier|static
specifier|final
name|int
name|PORT6
init|=
name|AvailablePortFinder
operator|.
name|getNextAvailable
argument_list|()
decl_stmt|;
DECL|field|PORT7
specifier|private
specifier|static
specifier|final
name|int
name|PORT7
init|=
name|AvailablePortFinder
operator|.
name|getNextAvailable
argument_list|()
decl_stmt|;
DECL|field|PORT8
specifier|private
specifier|static
specifier|final
name|int
name|PORT8
init|=
name|AvailablePortFinder
operator|.
name|getNextAvailable
argument_list|()
decl_stmt|;
annotation|@
name|Test
DECL|method|testSuccessfulCall ()
specifier|public
name|void
name|testSuccessfulCall
parameter_list|()
throws|throws
name|Exception
block|{
name|MockEndpoint
name|mock
init|=
name|getMockEndpoint
argument_list|(
literal|"mock:result"
argument_list|)
decl_stmt|;
name|mock
operator|.
name|expectedMinimumMessageCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedBodiesReceived
argument_list|(
literal|"Hello Camel CoAP"
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|Exchange
operator|.
name|CONTENT_TYPE
argument_list|,
name|MediaTypeRegistry
operator|.
name|toString
argument_list|(
name|MediaTypeRegistry
operator|.
name|APPLICATION_OCTET_STREAM
argument_list|)
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|CoAPConstants
operator|.
name|COAP_RESPONSE_CODE
argument_list|,
name|CoAP
operator|.
name|ResponseCode
operator|.
name|CONTENT
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sendBodyAndHeader
argument_list|(
literal|"direct:start"
argument_list|,
literal|"Camel CoAP"
argument_list|,
name|CoAPConstants
operator|.
name|COAP_METHOD
argument_list|,
literal|"POST"
argument_list|)
expr_stmt|;
name|assertMockEndpointsSatisfied
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testNoTruststore ()
specifier|public
name|void
name|testNoTruststore
parameter_list|()
throws|throws
name|Exception
block|{
name|MockEndpoint
name|mock
init|=
name|getMockEndpoint
argument_list|(
literal|"mock:result"
argument_list|)
decl_stmt|;
name|mock
operator|.
name|expectedMessageCount
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|sendBodyAndHeader
argument_list|(
literal|"direct:notruststore"
argument_list|,
literal|"Camel CoAP"
argument_list|,
name|CoAPConstants
operator|.
name|COAP_METHOD
argument_list|,
literal|"POST"
argument_list|)
expr_stmt|;
name|assertMockEndpointsSatisfied
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testTrustValidationFailed ()
specifier|public
name|void
name|testTrustValidationFailed
parameter_list|()
throws|throws
name|Exception
block|{
name|MockEndpoint
name|mock
init|=
name|getMockEndpoint
argument_list|(
literal|"mock:result"
argument_list|)
decl_stmt|;
name|mock
operator|.
name|expectedMessageCount
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|sendBodyAndHeader
argument_list|(
literal|"direct:failedtrust"
argument_list|,
literal|"Camel CoAP"
argument_list|,
name|CoAPConstants
operator|.
name|COAP_METHOD
argument_list|,
literal|"POST"
argument_list|)
expr_stmt|;
name|assertMockEndpointsSatisfied
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testSelfSigned ()
specifier|public
name|void
name|testSelfSigned
parameter_list|()
throws|throws
name|Exception
block|{
name|MockEndpoint
name|mock
init|=
name|getMockEndpoint
argument_list|(
literal|"mock:result"
argument_list|)
decl_stmt|;
name|mock
operator|.
name|expectedMinimumMessageCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedBodiesReceived
argument_list|(
literal|"Hello Camel CoAP"
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|Exchange
operator|.
name|CONTENT_TYPE
argument_list|,
name|MediaTypeRegistry
operator|.
name|toString
argument_list|(
name|MediaTypeRegistry
operator|.
name|APPLICATION_OCTET_STREAM
argument_list|)
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|CoAPConstants
operator|.
name|COAP_RESPONSE_CODE
argument_list|,
name|CoAP
operator|.
name|ResponseCode
operator|.
name|CONTENT
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sendBodyAndHeader
argument_list|(
literal|"direct:selfsigned"
argument_list|,
literal|"Camel CoAP"
argument_list|,
name|CoAPConstants
operator|.
name|COAP_METHOD
argument_list|,
literal|"POST"
argument_list|)
expr_stmt|;
name|assertMockEndpointsSatisfied
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testClientAuthentication ()
specifier|public
name|void
name|testClientAuthentication
parameter_list|()
throws|throws
name|Exception
block|{
name|MockEndpoint
name|mock
init|=
name|getMockEndpoint
argument_list|(
literal|"mock:result"
argument_list|)
decl_stmt|;
name|mock
operator|.
name|expectedMinimumMessageCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedBodiesReceived
argument_list|(
literal|"Hello Camel CoAP"
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|Exchange
operator|.
name|CONTENT_TYPE
argument_list|,
name|MediaTypeRegistry
operator|.
name|toString
argument_list|(
name|MediaTypeRegistry
operator|.
name|APPLICATION_OCTET_STREAM
argument_list|)
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|CoAPConstants
operator|.
name|COAP_RESPONSE_CODE
argument_list|,
name|CoAP
operator|.
name|ResponseCode
operator|.
name|CONTENT
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sendBodyAndHeader
argument_list|(
literal|"direct:clientauth"
argument_list|,
literal|"Camel CoAP"
argument_list|,
name|CoAPConstants
operator|.
name|COAP_METHOD
argument_list|,
literal|"POST"
argument_list|)
expr_stmt|;
name|assertMockEndpointsSatisfied
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testFailedClientAuthentication ()
specifier|public
name|void
name|testFailedClientAuthentication
parameter_list|()
throws|throws
name|Exception
block|{
name|MockEndpoint
name|mock
init|=
name|getMockEndpoint
argument_list|(
literal|"mock:result"
argument_list|)
decl_stmt|;
name|mock
operator|.
name|expectedMessageCount
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|sendBodyAndHeader
argument_list|(
literal|"direct:failedclientauth"
argument_list|,
literal|"Camel CoAP"
argument_list|,
name|CoAPConstants
operator|.
name|COAP_METHOD
argument_list|,
literal|"POST"
argument_list|)
expr_stmt|;
name|assertMockEndpointsSatisfied
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testCipherSuites ()
specifier|public
name|void
name|testCipherSuites
parameter_list|()
throws|throws
name|Exception
block|{
name|MockEndpoint
name|mock
init|=
name|getMockEndpoint
argument_list|(
literal|"mock:result"
argument_list|)
decl_stmt|;
name|mock
operator|.
name|expectedMinimumMessageCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedBodiesReceived
argument_list|(
literal|"Hello Camel CoAP"
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|Exchange
operator|.
name|CONTENT_TYPE
argument_list|,
name|MediaTypeRegistry
operator|.
name|toString
argument_list|(
name|MediaTypeRegistry
operator|.
name|APPLICATION_OCTET_STREAM
argument_list|)
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|CoAPConstants
operator|.
name|COAP_RESPONSE_CODE
argument_list|,
name|CoAP
operator|.
name|ResponseCode
operator|.
name|CONTENT
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sendBodyAndHeader
argument_list|(
literal|"direct:ciphersuites"
argument_list|,
literal|"Camel CoAP"
argument_list|,
name|CoAPConstants
operator|.
name|COAP_METHOD
argument_list|,
literal|"POST"
argument_list|)
expr_stmt|;
name|assertMockEndpointsSatisfied
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRawPublicKey ()
specifier|public
name|void
name|testRawPublicKey
parameter_list|()
throws|throws
name|Exception
block|{
name|MockEndpoint
name|mock
init|=
name|getMockEndpoint
argument_list|(
literal|"mock:result"
argument_list|)
decl_stmt|;
name|mock
operator|.
name|expectedMinimumMessageCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedBodiesReceived
argument_list|(
literal|"Hello Camel CoAP"
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|Exchange
operator|.
name|CONTENT_TYPE
argument_list|,
name|MediaTypeRegistry
operator|.
name|toString
argument_list|(
name|MediaTypeRegistry
operator|.
name|APPLICATION_OCTET_STREAM
argument_list|)
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|CoAPConstants
operator|.
name|COAP_RESPONSE_CODE
argument_list|,
name|CoAP
operator|.
name|ResponseCode
operator|.
name|CONTENT
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sendBodyAndHeader
argument_list|(
literal|"direct:rpk"
argument_list|,
literal|"Camel CoAP"
argument_list|,
name|CoAPConstants
operator|.
name|COAP_METHOD
argument_list|,
literal|"POST"
argument_list|)
expr_stmt|;
name|assertMockEndpointsSatisfied
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRawPublicKeyNoTruststore ()
specifier|public
name|void
name|testRawPublicKeyNoTruststore
parameter_list|()
throws|throws
name|Exception
block|{
name|MockEndpoint
name|mock
init|=
name|getMockEndpoint
argument_list|(
literal|"mock:result"
argument_list|)
decl_stmt|;
name|mock
operator|.
name|expectedMessageCount
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|sendBodyAndHeader
argument_list|(
literal|"direct:rpknotruststore"
argument_list|,
literal|"Camel CoAP"
argument_list|,
name|CoAPConstants
operator|.
name|COAP_METHOD
argument_list|,
literal|"POST"
argument_list|)
expr_stmt|;
name|assertMockEndpointsSatisfied
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRawPublicKeyFailedTrust ()
specifier|public
name|void
name|testRawPublicKeyFailedTrust
parameter_list|()
throws|throws
name|Exception
block|{
name|MockEndpoint
name|mock
init|=
name|getMockEndpoint
argument_list|(
literal|"mock:result"
argument_list|)
decl_stmt|;
name|mock
operator|.
name|expectedMessageCount
argument_list|(
literal|0
argument_list|)
expr_stmt|;
name|sendBodyAndHeader
argument_list|(
literal|"direct:rpkfailedtrust"
argument_list|,
literal|"Camel CoAP"
argument_list|,
name|CoAPConstants
operator|.
name|COAP_METHOD
argument_list|,
literal|"POST"
argument_list|)
expr_stmt|;
name|assertMockEndpointsSatisfied
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testRawPublicKeyClientAuth ()
specifier|public
name|void
name|testRawPublicKeyClientAuth
parameter_list|()
throws|throws
name|Exception
block|{
name|MockEndpoint
name|mock
init|=
name|getMockEndpoint
argument_list|(
literal|"mock:result"
argument_list|)
decl_stmt|;
name|mock
operator|.
name|expectedMinimumMessageCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedBodiesReceived
argument_list|(
literal|"Hello Camel CoAP"
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|Exchange
operator|.
name|CONTENT_TYPE
argument_list|,
name|MediaTypeRegistry
operator|.
name|toString
argument_list|(
name|MediaTypeRegistry
operator|.
name|APPLICATION_OCTET_STREAM
argument_list|)
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|CoAPConstants
operator|.
name|COAP_RESPONSE_CODE
argument_list|,
name|CoAP
operator|.
name|ResponseCode
operator|.
name|CONTENT
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sendBodyAndHeader
argument_list|(
literal|"direct:rpkclientauth"
argument_list|,
literal|"Camel CoAP"
argument_list|,
name|CoAPConstants
operator|.
name|COAP_METHOD
argument_list|,
literal|"POST"
argument_list|)
expr_stmt|;
name|assertMockEndpointsSatisfied
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testPreSharedKey ()
specifier|public
name|void
name|testPreSharedKey
parameter_list|()
throws|throws
name|Exception
block|{
name|MockEndpoint
name|mock
init|=
name|getMockEndpoint
argument_list|(
literal|"mock:result"
argument_list|)
decl_stmt|;
name|mock
operator|.
name|expectedMinimumMessageCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedBodiesReceived
argument_list|(
literal|"Hello Camel CoAP"
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|Exchange
operator|.
name|CONTENT_TYPE
argument_list|,
name|MediaTypeRegistry
operator|.
name|toString
argument_list|(
name|MediaTypeRegistry
operator|.
name|APPLICATION_OCTET_STREAM
argument_list|)
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|CoAPConstants
operator|.
name|COAP_RESPONSE_CODE
argument_list|,
name|CoAP
operator|.
name|ResponseCode
operator|.
name|CONTENT
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sendBodyAndHeader
argument_list|(
literal|"direct:psk"
argument_list|,
literal|"Camel CoAP"
argument_list|,
name|CoAPConstants
operator|.
name|COAP_METHOD
argument_list|,
literal|"POST"
argument_list|)
expr_stmt|;
name|assertMockEndpointsSatisfied
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testPreSharedKeyCipherSuite ()
specifier|public
name|void
name|testPreSharedKeyCipherSuite
parameter_list|()
throws|throws
name|Exception
block|{
name|MockEndpoint
name|mock
init|=
name|getMockEndpoint
argument_list|(
literal|"mock:result"
argument_list|)
decl_stmt|;
name|mock
operator|.
name|expectedMinimumMessageCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedBodiesReceived
argument_list|(
literal|"Hello Camel CoAP"
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|Exchange
operator|.
name|CONTENT_TYPE
argument_list|,
name|MediaTypeRegistry
operator|.
name|toString
argument_list|(
name|MediaTypeRegistry
operator|.
name|APPLICATION_OCTET_STREAM
argument_list|)
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|CoAPConstants
operator|.
name|COAP_RESPONSE_CODE
argument_list|,
name|CoAP
operator|.
name|ResponseCode
operator|.
name|CONTENT
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sendBodyAndHeader
argument_list|(
literal|"direct:pskciphersuite"
argument_list|,
literal|"Camel CoAP"
argument_list|,
name|CoAPConstants
operator|.
name|COAP_METHOD
argument_list|,
literal|"POST"
argument_list|)
expr_stmt|;
name|assertMockEndpointsSatisfied
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Test
DECL|method|testPreSharedKeyX509 ()
specifier|public
name|void
name|testPreSharedKeyX509
parameter_list|()
throws|throws
name|Exception
block|{
name|MockEndpoint
name|mock
init|=
name|getMockEndpoint
argument_list|(
literal|"mock:result"
argument_list|)
decl_stmt|;
name|mock
operator|.
name|expectedMinimumMessageCount
argument_list|(
literal|1
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedBodiesReceived
argument_list|(
literal|"Hello Camel CoAP"
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|Exchange
operator|.
name|CONTENT_TYPE
argument_list|,
name|MediaTypeRegistry
operator|.
name|toString
argument_list|(
name|MediaTypeRegistry
operator|.
name|APPLICATION_OCTET_STREAM
argument_list|)
argument_list|)
expr_stmt|;
name|mock
operator|.
name|expectedHeaderReceived
argument_list|(
name|CoAPConstants
operator|.
name|COAP_RESPONSE_CODE
argument_list|,
name|CoAP
operator|.
name|ResponseCode
operator|.
name|CONTENT
operator|.
name|toString
argument_list|()
argument_list|)
expr_stmt|;
name|sendBodyAndHeader
argument_list|(
literal|"direct:pskx509"
argument_list|,
literal|"Camel CoAP"
argument_list|,
name|CoAPConstants
operator|.
name|COAP_METHOD
argument_list|,
literal|"POST"
argument_list|)
expr_stmt|;
name|assertMockEndpointsSatisfied
argument_list|()
expr_stmt|;
block|}
annotation|@
name|Override
DECL|method|createRouteBuilder ()
specifier|protected
name|RouteBuilder
name|createRouteBuilder
parameter_list|()
throws|throws
name|Exception
block|{
name|registerTLSConfiguration
argument_list|()
expr_stmt|;
return|return
operator|new
name|RouteBuilder
argument_list|()
block|{
annotation|@
name|Override
specifier|public
name|void
name|configure
parameter_list|()
throws|throws
name|Exception
block|{
name|fromF
argument_list|(
literal|"coaps://localhost:%d/TestResource?sslContextParameters=#serviceSSLContextParameters"
argument_list|,
name|PORT
argument_list|)
operator|.
name|transform
argument_list|(
name|body
argument_list|()
operator|.
name|prepend
argument_list|(
literal|"Hello "
argument_list|)
argument_list|)
expr_stmt|;
name|fromF
argument_list|(
literal|"coaps://localhost:%d/TestResource?alias=selfsigned&sslContextParameters=#selfSignedServiceSSLContextParameters"
argument_list|,
name|PORT2
argument_list|)
operator|.
name|transform
argument_list|(
name|body
argument_list|()
operator|.
name|prepend
argument_list|(
literal|"Hello "
argument_list|)
argument_list|)
expr_stmt|;
name|fromF
argument_list|(
literal|"coaps://localhost:%d/TestResource?sslContextParameters=#clientAuthServiceSSLContextParameters"
argument_list|,
name|PORT3
argument_list|)
operator|.
name|transform
argument_list|(
name|body
argument_list|()
operator|.
name|prepend
argument_list|(
literal|"Hello "
argument_list|)
argument_list|)
expr_stmt|;
name|fromF
argument_list|(
literal|"coaps://localhost:%d/TestResource?sslContextParameters=#serviceSSLContextParameters&cipherSuites=TLS_ECDHE_ECDSA_WITH_AES_128_CCM_8"
argument_list|,
name|PORT4
argument_list|)
operator|.
name|transform
argument_list|(
name|body
argument_list|()
operator|.
name|prepend
argument_list|(
literal|"Hello "
argument_list|)
argument_list|)
expr_stmt|;
name|fromF
argument_list|(
literal|"coaps://localhost:%d/TestResource?privateKey=#privateKey&publicKey=#publicKey"
argument_list|,
name|PORT5
argument_list|)
operator|.
name|transform
argument_list|(
name|body
argument_list|()
operator|.
name|prepend
argument_list|(
literal|"Hello "
argument_list|)
argument_list|)
expr_stmt|;
name|fromF
argument_list|(
literal|"coaps://localhost:%d/TestResource?privateKey=#privateKey&publicKey=#publicKey&clientAuthentication=REQUIRE&trustedRpkStore=#trustedRpkStore"
argument_list|,
name|PORT6
argument_list|)
operator|.
name|transform
argument_list|(
name|body
argument_list|()
operator|.
name|prepend
argument_list|(
literal|"Hello "
argument_list|)
argument_list|)
expr_stmt|;
name|fromF
argument_list|(
literal|"coaps://localhost:%d/TestResource?pskStore=#pskStore"
argument_list|,
name|PORT7
argument_list|)
operator|.
name|transform
argument_list|(
name|body
argument_list|()
operator|.
name|prepend
argument_list|(
literal|"Hello "
argument_list|)
argument_list|)
expr_stmt|;
name|fromF
argument_list|(
literal|"coaps://localhost:%d/TestResource?sslContextParameters=#serviceSSLContextParameters&pskStore=#pskStore"
argument_list|,
name|PORT8
argument_list|)
operator|.
name|transform
argument_list|(
name|body
argument_list|()
operator|.
name|prepend
argument_list|(
literal|"Hello "
argument_list|)
argument_list|)
expr_stmt|;
name|from
argument_list|(
literal|"direct:start"
argument_list|)
operator|.
name|toF
argument_list|(
literal|"coaps://localhost:%d/TestResource?sslContextParameters=#clientSSLContextParameters"
argument_list|,
name|PORT
argument_list|)
operator|.
name|to
argument_list|(
literal|"mock:result"
argument_list|)
expr_stmt|;
name|from
argument_list|(
literal|"direct:notruststore"
argument_list|)
operator|.
name|toF
argument_list|(
literal|"coaps://localhost:%d/TestResource"
argument_list|,
name|PORT
argument_list|)
operator|.
name|to
argument_list|(
literal|"mock:result"
argument_list|)
expr_stmt|;
name|from
argument_list|(
literal|"direct:failedtrust"
argument_list|)
operator|.
name|toF
argument_list|(
literal|"coaps://localhost:%d/TestResource?sslContextParameters=#clientSSLContextParameters2"
argument_list|,
name|PORT
argument_list|)
operator|.
name|to
argument_list|(
literal|"mock:result"
argument_list|)
expr_stmt|;
name|from
argument_list|(
literal|"direct:selfsigned"
argument_list|)
operator|.
name|toF
argument_list|(
literal|"coaps://localhost:%d/TestResource?sslContextParameters=#selfSignedClientSSLContextParameters"
argument_list|,
name|PORT2
argument_list|)
operator|.
name|to
argument_list|(
literal|"mock:result"
argument_list|)
expr_stmt|;
name|from
argument_list|(
literal|"direct:clientauth"
argument_list|)
operator|.
name|toF
argument_list|(
literal|"coaps://localhost:%d/TestResource?sslContextParameters=#clientAuthClientSSLContextParameters"
argument_list|,
name|PORT3
argument_list|)
operator|.
name|to
argument_list|(
literal|"mock:result"
argument_list|)
expr_stmt|;
name|from
argument_list|(
literal|"direct:failedclientauth"
argument_list|)
operator|.
name|toF
argument_list|(
literal|"coaps://localhost:%d/TestResource?sslContextParameters=#clientAuthClientSSLContextParameters2"
argument_list|,
name|PORT3
argument_list|)
operator|.
name|to
argument_list|(
literal|"mock:result"
argument_list|)
expr_stmt|;
name|from
argument_list|(
literal|"direct:ciphersuites"
argument_list|)
operator|.
name|toF
argument_list|(
literal|"coaps://localhost:%d/TestResource?sslContextParameters=#clientSSLContextParameters&cipherSuites=TLS_ECDHE_ECDSA_WITH_AES_128_CCM_8"
argument_list|,
name|PORT4
argument_list|)
operator|.
name|to
argument_list|(
literal|"mock:result"
argument_list|)
expr_stmt|;
name|from
argument_list|(
literal|"direct:rpk"
argument_list|)
operator|.
name|toF
argument_list|(
literal|"coaps://localhost:%d/TestResource?trustedRpkStore=#trustedRpkStore"
argument_list|,
name|PORT5
argument_list|)
operator|.
name|to
argument_list|(
literal|"mock:result"
argument_list|)
expr_stmt|;
name|from
argument_list|(
literal|"direct:rpknotruststore"
argument_list|)
operator|.
name|toF
argument_list|(
literal|"coaps://localhost:%d/TestResource"
argument_list|,
name|PORT5
argument_list|)
operator|.
name|to
argument_list|(
literal|"mock:result"
argument_list|)
expr_stmt|;
name|from
argument_list|(
literal|"direct:rpkfailedtrust"
argument_list|)
operator|.
name|toF
argument_list|(
literal|"coaps://localhost:%d/TestResource?trustedRpkStore=#failedTrustedRpkStore"
argument_list|,
name|PORT5
argument_list|)
operator|.
name|to
argument_list|(
literal|"mock:result"
argument_list|)
expr_stmt|;
name|from
argument_list|(
literal|"direct:rpkclientauth"
argument_list|)
operator|.
name|toF
argument_list|(
literal|"coaps://localhost:%d/TestResource?trustedRpkStore=#trustedRpkStore&privateKey=#privateKey&publicKey=#publicKey"
argument_list|,
name|PORT6
argument_list|)
operator|.
name|to
argument_list|(
literal|"mock:result"
argument_list|)
expr_stmt|;
name|from
argument_list|(
literal|"direct:psk"
argument_list|)
operator|.
name|toF
argument_list|(
literal|"coaps://localhost:%d/TestResource?pskStore=#pskStore"
argument_list|,
name|PORT7
argument_list|)
operator|.
name|to
argument_list|(
literal|"mock:result"
argument_list|)
expr_stmt|;
name|from
argument_list|(
literal|"direct:pskciphersuite"
argument_list|)
operator|.
name|toF
argument_list|(
literal|"coaps://localhost:%d/TestResource?pskStore=#pskStore&cipherSuites=TLS_PSK_WITH_AES_128_CBC_SHA256"
argument_list|,
name|PORT7
argument_list|)
operator|.
name|to
argument_list|(
literal|"mock:result"
argument_list|)
expr_stmt|;
name|from
argument_list|(
literal|"direct:pskx509"
argument_list|)
operator|.
name|toF
argument_list|(
literal|"coaps://localhost:%d/TestResource?pskStore=#pskStore&sslContextParameters=#clientSSLContextParameters"
argument_list|,
name|PORT8
argument_list|)
operator|.
name|to
argument_list|(
literal|"mock:result"
argument_list|)
expr_stmt|;
block|}
block|}
return|;
block|}
DECL|method|registerTLSConfiguration ()
specifier|private
name|void
name|registerTLSConfiguration
parameter_list|()
throws|throws
name|GeneralSecurityException
throws|,
name|IOException
block|{
name|KeyStoreParameters
name|serviceKeystoreParameters
init|=
operator|new
name|KeyStoreParameters
argument_list|()
decl_stmt|;
name|serviceKeystoreParameters
operator|.
name|setResource
argument_list|(
literal|"service.jks"
argument_list|)
expr_stmt|;
name|serviceKeystoreParameters
operator|.
name|setPassword
argument_list|(
literal|"security"
argument_list|)
expr_stmt|;
name|KeyStoreParameters
name|selfSignedKeyStoreParameters
init|=
operator|new
name|KeyStoreParameters
argument_list|()
decl_stmt|;
name|selfSignedKeyStoreParameters
operator|.
name|setResource
argument_list|(
literal|"selfsigned.jks"
argument_list|)
expr_stmt|;
name|selfSignedKeyStoreParameters
operator|.
name|setPassword
argument_list|(
literal|"security"
argument_list|)
expr_stmt|;
name|KeyStoreParameters
name|clientKeystoreParameters
init|=
operator|new
name|KeyStoreParameters
argument_list|()
decl_stmt|;
name|clientKeystoreParameters
operator|.
name|setResource
argument_list|(
literal|"client.jks"
argument_list|)
expr_stmt|;
name|clientKeystoreParameters
operator|.
name|setPassword
argument_list|(
literal|"security"
argument_list|)
expr_stmt|;
name|KeyStoreParameters
name|truststoreParameters
init|=
operator|new
name|KeyStoreParameters
argument_list|()
decl_stmt|;
name|truststoreParameters
operator|.
name|setResource
argument_list|(
literal|"truststore.jks"
argument_list|)
expr_stmt|;
name|truststoreParameters
operator|.
name|setPassword
argument_list|(
literal|"storepass"
argument_list|)
expr_stmt|;
name|KeyStoreParameters
name|truststoreParameters2
init|=
operator|new
name|KeyStoreParameters
argument_list|()
decl_stmt|;
name|truststoreParameters2
operator|.
name|setResource
argument_list|(
literal|"truststore2.jks"
argument_list|)
expr_stmt|;
name|truststoreParameters2
operator|.
name|setPassword
argument_list|(
literal|"storepass"
argument_list|)
expr_stmt|;
name|SSLContextParameters
name|serviceSSLContextParameters
init|=
operator|new
name|SSLContextParameters
argument_list|()
decl_stmt|;
name|KeyManagersParameters
name|serviceSSLKeyManagers
init|=
operator|new
name|KeyManagersParameters
argument_list|()
decl_stmt|;
name|serviceSSLKeyManagers
operator|.
name|setKeyPassword
argument_list|(
literal|"security"
argument_list|)
expr_stmt|;
name|serviceSSLKeyManagers
operator|.
name|setKeyStore
argument_list|(
name|serviceKeystoreParameters
argument_list|)
expr_stmt|;
name|serviceSSLContextParameters
operator|.
name|setKeyManagers
argument_list|(
name|serviceSSLKeyManagers
argument_list|)
expr_stmt|;
name|SSLContextParameters
name|selfSignedServiceSSLContextParameters
init|=
operator|new
name|SSLContextParameters
argument_list|()
decl_stmt|;
name|KeyManagersParameters
name|selfSignedServiceSSLKeyManagers
init|=
operator|new
name|KeyManagersParameters
argument_list|()
decl_stmt|;
name|selfSignedServiceSSLKeyManagers
operator|.
name|setKeyPassword
argument_list|(
literal|"security"
argument_list|)
expr_stmt|;
name|selfSignedServiceSSLKeyManagers
operator|.
name|setKeyStore
argument_list|(
name|selfSignedKeyStoreParameters
argument_list|)
expr_stmt|;
name|selfSignedServiceSSLContextParameters
operator|.
name|setKeyManagers
argument_list|(
name|selfSignedServiceSSLKeyManagers
argument_list|)
expr_stmt|;
name|SSLContextParameters
name|clientAuthServiceSSLContextParameters
init|=
operator|new
name|SSLContextParameters
argument_list|()
decl_stmt|;
name|KeyManagersParameters
name|clientAuthServiceSSLKeyManagers
init|=
operator|new
name|KeyManagersParameters
argument_list|()
decl_stmt|;
name|clientAuthServiceSSLKeyManagers
operator|.
name|setKeyPassword
argument_list|(
literal|"security"
argument_list|)
expr_stmt|;
name|clientAuthServiceSSLKeyManagers
operator|.
name|setKeyStore
argument_list|(
name|serviceKeystoreParameters
argument_list|)
expr_stmt|;
name|clientAuthServiceSSLContextParameters
operator|.
name|setKeyManagers
argument_list|(
name|clientAuthServiceSSLKeyManagers
argument_list|)
expr_stmt|;
name|TrustManagersParameters
name|clientAuthServiceSSLTrustManagers
init|=
operator|new
name|TrustManagersParameters
argument_list|()
decl_stmt|;
name|clientAuthServiceSSLTrustManagers
operator|.
name|setKeyStore
argument_list|(
name|truststoreParameters
argument_list|)
expr_stmt|;
name|clientAuthServiceSSLContextParameters
operator|.
name|setTrustManagers
argument_list|(
name|clientAuthServiceSSLTrustManagers
argument_list|)
expr_stmt|;
name|SSLContextServerParameters
name|clientAuthSSLContextServerParameters
init|=
operator|new
name|SSLContextServerParameters
argument_list|()
decl_stmt|;
name|clientAuthSSLContextServerParameters
operator|.
name|setClientAuthentication
argument_list|(
literal|"REQUIRE"
argument_list|)
expr_stmt|;
name|clientAuthServiceSSLContextParameters
operator|.
name|setServerParameters
argument_list|(
name|clientAuthSSLContextServerParameters
argument_list|)
expr_stmt|;
name|SSLContextParameters
name|clientSSLContextParameters
init|=
operator|new
name|SSLContextParameters
argument_list|()
decl_stmt|;
name|TrustManagersParameters
name|clientSSLTrustManagers
init|=
operator|new
name|TrustManagersParameters
argument_list|()
decl_stmt|;
name|clientSSLTrustManagers
operator|.
name|setKeyStore
argument_list|(
name|truststoreParameters
argument_list|)
expr_stmt|;
name|clientSSLContextParameters
operator|.
name|setTrustManagers
argument_list|(
name|clientSSLTrustManagers
argument_list|)
expr_stmt|;
name|SSLContextParameters
name|clientSSLContextParameters2
init|=
operator|new
name|SSLContextParameters
argument_list|()
decl_stmt|;
name|TrustManagersParameters
name|clientSSLTrustManagers2
init|=
operator|new
name|TrustManagersParameters
argument_list|()
decl_stmt|;
name|clientSSLTrustManagers2
operator|.
name|setKeyStore
argument_list|(
name|truststoreParameters2
argument_list|)
expr_stmt|;
name|clientSSLContextParameters2
operator|.
name|setTrustManagers
argument_list|(
name|clientSSLTrustManagers2
argument_list|)
expr_stmt|;
name|SSLContextParameters
name|clientAuthClientSSLContextParameters
init|=
operator|new
name|SSLContextParameters
argument_list|()
decl_stmt|;
name|TrustManagersParameters
name|clientAuthClientSSLTrustManagers
init|=
operator|new
name|TrustManagersParameters
argument_list|()
decl_stmt|;
name|clientAuthClientSSLTrustManagers
operator|.
name|setKeyStore
argument_list|(
name|truststoreParameters
argument_list|)
expr_stmt|;
name|clientAuthClientSSLContextParameters
operator|.
name|setTrustManagers
argument_list|(
name|clientAuthClientSSLTrustManagers
argument_list|)
expr_stmt|;
name|KeyManagersParameters
name|clientAuthClientSSLKeyManagers
init|=
operator|new
name|KeyManagersParameters
argument_list|()
decl_stmt|;
name|clientAuthClientSSLKeyManagers
operator|.
name|setKeyPassword
argument_list|(
literal|"security"
argument_list|)
expr_stmt|;
name|clientAuthClientSSLKeyManagers
operator|.
name|setKeyStore
argument_list|(
name|clientKeystoreParameters
argument_list|)
expr_stmt|;
name|clientAuthClientSSLContextParameters
operator|.
name|setKeyManagers
argument_list|(
name|clientAuthClientSSLKeyManagers
argument_list|)
expr_stmt|;
name|SSLContextParameters
name|clientAuthClientSSLContextParameters2
init|=
operator|new
name|SSLContextParameters
argument_list|()
decl_stmt|;
name|TrustManagersParameters
name|clientAuthClientSSLTrustManagers2
init|=
operator|new
name|TrustManagersParameters
argument_list|()
decl_stmt|;
name|clientAuthClientSSLTrustManagers2
operator|.
name|setKeyStore
argument_list|(
name|truststoreParameters2
argument_list|)
expr_stmt|;
name|clientAuthClientSSLContextParameters2
operator|.
name|setTrustManagers
argument_list|(
name|clientAuthClientSSLTrustManagers2
argument_list|)
expr_stmt|;
name|KeyManagersParameters
name|clientAuthClientSSLKeyManagers2
init|=
operator|new
name|KeyManagersParameters
argument_list|()
decl_stmt|;
name|clientAuthClientSSLKeyManagers2
operator|.
name|setKeyPassword
argument_list|(
literal|"security"
argument_list|)
expr_stmt|;
name|clientAuthClientSSLKeyManagers2
operator|.
name|setKeyStore
argument_list|(
name|clientKeystoreParameters
argument_list|)
expr_stmt|;
name|clientAuthClientSSLContextParameters2
operator|.
name|setKeyManagers
argument_list|(
name|clientAuthClientSSLKeyManagers2
argument_list|)
expr_stmt|;
name|SSLContextParameters
name|selfSignedClientSSLContextParameters
init|=
operator|new
name|SSLContextParameters
argument_list|()
decl_stmt|;
name|TrustManagersParameters
name|selfSignedClientSSLTrustManagers
init|=
operator|new
name|TrustManagersParameters
argument_list|()
decl_stmt|;
name|selfSignedClientSSLTrustManagers
operator|.
name|setKeyStore
argument_list|(
name|selfSignedKeyStoreParameters
argument_list|)
expr_stmt|;
name|selfSignedClientSSLContextParameters
operator|.
name|setTrustManagers
argument_list|(
name|selfSignedClientSSLTrustManagers
argument_list|)
expr_stmt|;
name|KeyStore
name|keyStore
init|=
name|serviceKeystoreParameters
operator|.
name|createKeyStore
argument_list|()
decl_stmt|;
name|PrivateKey
name|privateKey
init|=
operator|(
name|PrivateKey
operator|)
name|keyStore
operator|.
name|getKey
argument_list|(
literal|"service"
argument_list|,
literal|"security"
operator|.
name|toCharArray
argument_list|()
argument_list|)
decl_stmt|;
name|PublicKey
name|publicKey
init|=
name|keyStore
operator|.
name|getCertificate
argument_list|(
literal|"service"
argument_list|)
operator|.
name|getPublicKey
argument_list|()
decl_stmt|;
name|TrustedRpkStore
name|trustedRpkStore
init|=
name|id
lambda|->
block|{
return|return
literal|true
return|;
block|}
decl_stmt|;
name|TrustedRpkStore
name|failedTrustedRpkStore
init|=
name|id
lambda|->
block|{
return|return
literal|false
return|;
block|}
decl_stmt|;
name|KeyGenerator
name|keyGenerator
init|=
name|KeyGenerator
operator|.
name|getInstance
argument_list|(
literal|"AES"
argument_list|)
decl_stmt|;
name|PskStore
name|pskStore
init|=
operator|new
name|StaticPskStore
argument_list|(
literal|"some-identity"
argument_list|,
name|keyGenerator
operator|.
name|generateKey
argument_list|()
operator|.
name|getEncoded
argument_list|()
argument_list|)
decl_stmt|;
name|context
operator|.
name|getRegistry
argument_list|()
operator|.
name|bind
argument_list|(
literal|"serviceSSLContextParameters"
argument_list|,
name|serviceSSLContextParameters
argument_list|)
expr_stmt|;
name|context
operator|.
name|getRegistry
argument_list|()
operator|.
name|bind
argument_list|(
literal|"selfSignedServiceSSLContextParameters"
argument_list|,
name|selfSignedServiceSSLContextParameters
argument_list|)
expr_stmt|;
name|context
operator|.
name|getRegistry
argument_list|()
operator|.
name|bind
argument_list|(
literal|"clientAuthServiceSSLContextParameters"
argument_list|,
name|clientAuthServiceSSLContextParameters
argument_list|)
expr_stmt|;
name|context
operator|.
name|getRegistry
argument_list|()
operator|.
name|bind
argument_list|(
literal|"clientSSLContextParameters"
argument_list|,
name|clientSSLContextParameters
argument_list|)
expr_stmt|;
name|context
operator|.
name|getRegistry
argument_list|()
operator|.
name|bind
argument_list|(
literal|"clientSSLContextParameters2"
argument_list|,
name|clientSSLContextParameters2
argument_list|)
expr_stmt|;
name|context
operator|.
name|getRegistry
argument_list|()
operator|.
name|bind
argument_list|(
literal|"clientAuthClientSSLContextParameters"
argument_list|,
name|clientAuthClientSSLContextParameters
argument_list|)
expr_stmt|;
name|context
operator|.
name|getRegistry
argument_list|()
operator|.
name|bind
argument_list|(
literal|"clientAuthClientSSLContextParameters2"
argument_list|,
name|clientAuthClientSSLContextParameters2
argument_list|)
expr_stmt|;
name|context
operator|.
name|getRegistry
argument_list|()
operator|.
name|bind
argument_list|(
literal|"selfSignedClientSSLContextParameters"
argument_list|,
name|selfSignedClientSSLContextParameters
argument_list|)
expr_stmt|;
name|context
operator|.
name|getRegistry
argument_list|()
operator|.
name|bind
argument_list|(
literal|"privateKey"
argument_list|,
name|privateKey
argument_list|)
expr_stmt|;
name|context
operator|.
name|getRegistry
argument_list|()
operator|.
name|bind
argument_list|(
literal|"publicKey"
argument_list|,
name|publicKey
argument_list|)
expr_stmt|;
name|context
operator|.
name|getRegistry
argument_list|()
operator|.
name|bind
argument_list|(
literal|"trustedRpkStore"
argument_list|,
name|trustedRpkStore
argument_list|)
expr_stmt|;
name|context
operator|.
name|getRegistry
argument_list|()
operator|.
name|bind
argument_list|(
literal|"failedTrustedRpkStore"
argument_list|,
name|failedTrustedRpkStore
argument_list|)
expr_stmt|;
name|context
operator|.
name|getRegistry
argument_list|()
operator|.
name|bind
argument_list|(
literal|"pskStore"
argument_list|,
name|pskStore
argument_list|)
expr_stmt|;
block|}
DECL|method|sendBodyAndHeader (String endpointUri, final Object body, String headerName, String headerValue)
specifier|protected
name|void
name|sendBodyAndHeader
parameter_list|(
name|String
name|endpointUri
parameter_list|,
specifier|final
name|Object
name|body
parameter_list|,
name|String
name|headerName
parameter_list|,
name|String
name|headerValue
parameter_list|)
block|{
name|template
operator|.
name|send
argument_list|(
name|endpointUri
argument_list|,
operator|new
name|Processor
argument_list|()
block|{
specifier|public
name|void
name|process
parameter_list|(
name|Exchange
name|exchange
parameter_list|)
block|{
name|Message
name|in
init|=
name|exchange
operator|.
name|getIn
argument_list|()
decl_stmt|;
name|in
operator|.
name|setBody
argument_list|(
name|body
argument_list|)
expr_stmt|;
name|in
operator|.
name|setHeader
argument_list|(
name|headerName
argument_list|,
name|headerValue
argument_list|)
expr_stmt|;
block|}
block|}
argument_list|)
expr_stmt|;
block|}
block|}
end_class

end_unit


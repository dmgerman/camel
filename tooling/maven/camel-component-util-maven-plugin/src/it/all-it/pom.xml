<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Licensed to the Apache Software Foundation (ASF) under one or more
  ~ contributor license agreements.  See the NOTICE file distributed with
  ~ this work for additional information regarding copyright ownership.
  ~ The ASF licenses this file to You under the Apache License, Version 2.0
  ~ (the "License"); you may not use this file except in compliance with
  ~ the License.  You may obtain a copy of the License at
  ~
  ~    http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <groupId>org.apache.camel</groupId>
  <artifactId>camel-component-util-maven-plugin-it</artifactId>
  <version>1.0-SNAPSHOT</version>

  <description>Integration Test to verify all goals.</description>

  <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <outPackage>org.apache.camel.component.test.internal</outPackage>
    <componentPackage>org.apache.camel.component.test</componentPackage>
    <scheme>testComponent</scheme>
    <componentName>Test</componentName>
  </properties>

  <dependencies>
    <dependency>
      <groupId>org.apache.camel</groupId>
      <artifactId>camel-core</artifactId>
      <version>@project.version@</version>
    </dependency>
    <dependency>
      <groupId>org.apache.velocity</groupId>
      <artifactId>velocity</artifactId>
      <version>@velocity-version@</version>
    </dependency>

    <dependency>
      <groupId>org.apache.camel</groupId>
      <artifactId>camel-test</artifactId>
      <version>@project.version@</version>
      <scope>test</scope>
    </dependency>
    <!-- VelocityEngine javadoc for testing -->
    <dependency>
      <groupId>org.apache.velocity</groupId>
      <artifactId>velocity</artifactId>
      <version>@velocity-version@</version>
      <classifier>javadoc</classifier>
      <scope>test</scope>
    </dependency>
  </dependencies>

  <build>
    <plugins>
      <!-- execute component-util plugin -->
      <plugin>
        <groupId>@project.groupId@</groupId>
        <artifactId>@project.artifactId@</artifactId>
        <version>@project.version@</version>
        <executions>
          <execution>
            <id>generate-file-api-method</id>
            <!-- using generate-test-sources instead of generate-sources to be able to load TestProxy.class -->
            <phase>generate-test-sources</phase>
            <goals>
              <goal>fromFile</goal>
            </goals>
            <configuration>
              <outPackage>${outPackage}</outPackage>
              <componentPackage>${componentPackage}</componentPackage>
              <scheme>${scheme}</scheme>
              <componentName>${componentName}</componentName>
              <proxyClass>org.apache.camel.component.test.TestProxy</proxyClass>
              <substitutions>
                <substitution>
                  <method>.+</method>
                  <argName>(.+)</argName>
                  <argType>java.util.List</argType>
                  <replacement>$1List</replacement>
                </substitution>
              </substitutions>
              <signatureFile>../../../src/test/resources/test-proxy-signatures.txt</signatureFile>
            </configuration>
          </execution>
          <execution>
            <id>generate-velocity-context-api-method</id>
            <phase>generate-test-sources</phase>
            <goals>
              <goal>fromJavadoc</goal>
            </goals>
            <configuration>
              <outPackage>${outPackage}</outPackage>
              <componentPackage>${componentPackage}</componentPackage>
              <scheme>${scheme}</scheme>
              <componentName>${componentName}</componentName>
              <proxyClass>org.apache.velocity.VelocityContext</proxyClass>
              <substitutions>
                <substitution>
                  <method>.+</method>
                  <argName>key</argName>
                  <argType>java.lang.Object</argType>
                  <replacement>applicationKey</replacement>
                </substitution>
              </substitutions>
              <excludeClasses>InternalContextBase</excludeClasses>
              <excludeMethods>clone|Current|internal|icache</excludeMethods>
            </configuration>
          </execution>
          <execution>
            <id>generate-test-component-classes</id>
            <phase>generate-test-sources</phase>
            <goals>
              <goal>fromApis</goal>
            </goals>
            <configuration>
              <outPackage>${outPackage}</outPackage>
              <componentPackage>${componentPackage}</componentPackage>
              <scheme>${scheme}</scheme>
              <componentName>${componentName}</componentName>
              <apis>
                <api>
                  <apiName>test</apiName>
                  <proxyClass>org.apache.camel.component.test.TestProxy</proxyClass>
                </api>
                <api>
                  <apiName>velocity</apiName>
                  <proxyClass>org.apache.velocity.VelocityContext</proxyClass>
                </api>
              </apis>
            </configuration>
          </execution>
        </executions>
      </plugin>
      <!-- add generated source and test source to build -->
      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>build-helper-maven-plugin</artifactId>
        <version>@build-helper-maven-plugin-version@</version>
        <executions>
          <execution>
            <id>add-generated-sources</id>
            <goals>
              <goal>add-source</goal>
            </goals>
            <configuration>
              <sources>
                <source>${project.build.directory}/generated-sources/camel-component</source>
              </sources>
            </configuration>
          </execution>
          <execution>
            <id>add-generated-test-sources</id>
            <goals>
              <goal>add-test-source</goal>
            </goals>
            <configuration>
              <sources>
                <source>${project.build.directory}/generated-test-sources/camel-component</source>
              </sources>
            </configuration>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build>

</project>
